if(typeof(dojo)!="undefined"){dojo.provide("MochiKit.Signal");dojo.require("MochiKit.Base");dojo.require("MochiKit.DOM");dojo.require("MochiKit.Style")}if(typeof(JSAN)!="undefined"){JSAN.use("MochiKit.Base",[]);JSAN.use("MochiKit.DOM",[])}try{if(typeof(MochiKit.Base)=="undefined"){throw""}}catch(e){throw"MochiKit.Signal depends on MochiKit.Base!"}try{if(typeof(MochiKit.DOM)=="undefined"){throw""}}catch(e){throw"MochiKit.Signal depends on MochiKit.DOM!"}try{if(typeof(MochiKit.Style)=="undefined"){throw""}}catch(e){throw"MochiKit.Signal depends on MochiKit.Style!"}if(typeof(MochiKit.Signal)=="undefined"){MochiKit.Signal={}}MochiKit.Signal.NAME="MochiKit.Signal";MochiKit.Signal.VERSION="1.4";MochiKit.Signal._observers=[];MochiKit.Signal.Event=function(b,a){this._event=a||window.event;this._src=b};MochiKit.Base.update(MochiKit.Signal.Event.prototype,{__repr__:function(){var a=MochiKit.Base.repr;var b="{event(): "+a(this.event())+", src(): "+a(this.src())+", type(): "+a(this.type())+", target(): "+a(this.target())+", modifier(): {alt: "+a(this.modifier().alt)+", ctrl: "+a(this.modifier().ctrl)+", meta: "+a(this.modifier().meta)+", shift: "+a(this.modifier().shift)+", any: "+a(this.modifier().any)+"}";if(this.type()&&this.type().indexOf("key")===0){b+=", key(): {code: "+a(this.key().code)+", string: "+a(this.key().string)+"}"}if(this.type()&&(this.type().indexOf("mouse")===0||this.type().indexOf("click")!=-1||this.type()=="contextmenu")){b+=", mouse(): {page: "+a(this.mouse().page)+", client: "+a(this.mouse().client);if(this.type()!="mousemove"){b+=", button: {left: "+a(this.mouse().button.left)+", middle: "+a(this.mouse().button.middle)+", right: "+a(this.mouse().button.right)+"}}"}else{b+="}"}}if(this.type()=="mouseover"||this.type()=="mouseout"){b+=", relatedTarget(): "+a(this.relatedTarget())}b+="}";return b},toString:function(){return this.__repr__()},src:function(){return this._src},event:function(){return this._event},type:function(){return this._event.type||undefined},target:function(){return this._event.target||this._event.srcElement},_relatedTarget:null,relatedTarget:function(){if(this._relatedTarget!==null){return this._relatedTarget}var a=null;if(this.type()=="mouseover"){a=(this._event.relatedTarget||this._event.fromElement)}else{if(this.type()=="mouseout"){a=(this._event.relatedTarget||this._event.toElement)}}if(a!==null){this._relatedTarget=a;return a}return undefined},_modifier:null,modifier:function(){if(this._modifier!==null){return this._modifier}var a={};a.alt=this._event.altKey;a.ctrl=this._event.ctrlKey;a.meta=this._event.metaKey||false;a.shift=this._event.shiftKey;a.any=a.alt||a.ctrl||a.shift||a.meta;this._modifier=a;return a},_key:null,key:function(){if(this._key!==null){return this._key}var a={};if(this.type()&&this.type().indexOf("key")===0){if(this.type()=="keydown"||this.type()=="keyup"){a.code=this._event.keyCode;a.string=(MochiKit.Signal._specialKeys[a.code]||"KEY_UNKNOWN");this._key=a;return a}else{if(this.type()=="keypress"){a.code=0;a.string="";if(typeof(this._event.charCode)!="undefined"&&this._event.charCode!==0&&!MochiKit.Signal._specialMacKeys[this._event.charCode]){a.code=this._event.charCode;a.string=String.fromCharCode(a.code)}else{if(this._event.keyCode&&typeof(this._event.charCode)=="undefined"){a.code=this._event.keyCode;a.string=String.fromCharCode(a.code)}}this._key=a;return a}}}return undefined},_mouse:null,mouse:function(){if(this._mouse!==null){return this._mouse}var c={};var d=this._event;if(this.type()&&(this.type().indexOf("mouse")===0||this.type().indexOf("click")!=-1||this.type()=="contextmenu")){c.client=new MochiKit.Style.Coordinates(0,0);if(d.clientX||d.clientY){c.client.x=(!d.clientX||d.clientX<0)?0:d.clientX;c.client.y=(!d.clientY||d.clientY<0)?0:d.clientY}c.page=new MochiKit.Style.Coordinates(0,0);if(d.pageX||d.pageY){c.page.x=(!d.pageX||d.pageX<0)?0:d.pageX;c.page.y=(!d.pageY||d.pageY<0)?0:d.pageY}else{var f=MochiKit.DOM._document.documentElement;var a=MochiKit.DOM._document.body;c.page.x=d.clientX+(f.scrollLeft||a.scrollLeft)-(f.clientLeft||0);c.page.y=d.clientY+(f.scrollTop||a.scrollTop)-(f.clientTop||0)}if(this.type()!="mousemove"){c.button={};c.button.left=false;c.button.right=false;c.button.middle=false;if(d.which){c.button.left=(d.which==1);c.button.middle=(d.which==2);c.button.right=(d.which==3)}else{c.button.left=!!(d.button&1);c.button.right=!!(d.button&2);c.button.middle=!!(d.button&4)}}this._mouse=c;return c}return undefined},stop:function(){this.stopPropagation();this.preventDefault()},stopPropagation:function(){if(this._event.stopPropagation){this._event.stopPropagation()}else{this._event.cancelBubble=true}},preventDefault:function(){if(this._event.preventDefault){this._event.preventDefault()}else{if(this._confirmUnload===null){this._event.returnValue=false}}},_confirmUnload:null,confirmUnload:function(a){if(this.type()=="beforeunload"){this._confirmUnload=a;this._event.returnValue=a}}});MochiKit.Signal._specialMacKeys={3:"KEY_ENTER",63289:"KEY_NUM_PAD_CLEAR",63276:"KEY_PAGE_UP",63277:"KEY_PAGE_DOWN",63275:"KEY_END",63273:"KEY_HOME",63234:"KEY_ARROW_LEFT",63232:"KEY_ARROW_UP",63235:"KEY_ARROW_RIGHT",63233:"KEY_ARROW_DOWN",63302:"KEY_INSERT",63272:"KEY_DELETE"};for(i=63236;i<=63242;i++){MochiKit.Signal._specialMacKeys[i]="KEY_F"+(i-63236+1)}MochiKit.Signal._specialKeys={8:"KEY_BACKSPACE",9:"KEY_TAB",12:"KEY_NUM_PAD_CLEAR",13:"KEY_ENTER",16:"KEY_SHIFT",17:"KEY_CTRL",18:"KEY_ALT",19:"KEY_PAUSE",20:"KEY_CAPS_LOCK",27:"KEY_ESCAPE",32:"KEY_SPACEBAR",33:"KEY_PAGE_UP",34:"KEY_PAGE_DOWN",35:"KEY_END",36:"KEY_HOME",37:"KEY_ARROW_LEFT",38:"KEY_ARROW_UP",39:"KEY_ARROW_RIGHT",40:"KEY_ARROW_DOWN",44:"KEY_PRINT_SCREEN",45:"KEY_INSERT",46:"KEY_DELETE",59:"KEY_SEMICOLON",91:"KEY_WINDOWS_LEFT",92:"KEY_WINDOWS_RIGHT",93:"KEY_SELECT",106:"KEY_NUM_PAD_ASTERISK",107:"KEY_NUM_PAD_PLUS_SIGN",109:"KEY_NUM_PAD_HYPHEN-MINUS",110:"KEY_NUM_PAD_FULL_STOP",111:"KEY_NUM_PAD_SOLIDUS",144:"KEY_NUM_LOCK",145:"KEY_SCROLL_LOCK",186:"KEY_SEMICOLON",187:"KEY_EQUALS_SIGN",188:"KEY_COMMA",189:"KEY_HYPHEN-MINUS",190:"KEY_FULL_STOP",191:"KEY_SOLIDUS",192:"KEY_GRAVE_ACCENT",219:"KEY_LEFT_SQUARE_BRACKET",220:"KEY_REVERSE_SOLIDUS",221:"KEY_RIGHT_SQUARE_BRACKET",222:"KEY_APOSTROPHE"};for(var i=48;i<=57;i++){MochiKit.Signal._specialKeys[i]="KEY_"+(i-48)}for(i=65;i<=90;i++){MochiKit.Signal._specialKeys[i]="KEY_"+String.fromCharCode(i)}for(i=96;i<=105;i++){MochiKit.Signal._specialKeys[i]="KEY_NUM_PAD_"+(i-96)}for(i=112;i<=123;i++){MochiKit.Signal._specialKeys[i]="KEY_F"+(i-112+1)}MochiKit.Base.update(MochiKit.Signal,{__repr__:function(){return"["+this.NAME+" "+this.VERSION+"]"},toString:function(){return this.__repr__()},_unloadCache:function(){var a=MochiKit.Signal;var d=a._observers;for(var b=0;b<d.length;b++){a._disconnect(d[b])}delete a._observers;try{window.onload=undefined}catch(c){}try{window.onunload=undefined}catch(c){}},_listener:function(f,b,d,a){var c=MochiKit.Signal.Event;if(!a){return MochiKit.Base.bind(b,d)}d=d||f;if(typeof(b)=="string"){return function(g){d[b].apply(d,[new c(f,g)])}}else{return function(g){b.apply(d,[new c(f,g)])}}},connect:function(a,l,j,b){a=MochiKit.DOM.getElement(a);var k=MochiKit.Signal;if(typeof(l)!="string"){throw new Error("'sig' must be a string")}var g=null;var d=null;if(typeof(b)!="undefined"){g=j;d=b;if(typeof(b)=="string"){if(typeof(j[b])!="function"){throw new Error("'funcOrStr' must be a function on 'objOrFunc'")}}else{if(typeof(b)!="function"){throw new Error("'funcOrStr' must be a function or string")}}}else{if(typeof(j)!="function"){throw new Error("'objOrFunc' must be a function if 'funcOrStr' is not given")}else{d=j}}if(typeof(g)=="undefined"||g===null){g=a}var h=!!(a.addEventListener||a.attachEvent);var c=k._listener(a,d,g,h);if(a.addEventListener){a.addEventListener(l.substr(2),c,false)}else{if(a.attachEvent){a.attachEvent(l,c)}}var f=[a,l,c,h,j,b];k._observers.push(f);return f},_disconnect:function(b){if(!b[3]){return}var d=b[0];var c=b[1];var a=b[2];if(d.removeEventListener){d.removeEventListener(c.substr(2),a,false)}else{if(d.detachEvent){d.detachEvent(c,a)}else{throw new Error("'src' must be a DOM element")}}},disconnect:function(h){var l=MochiKit.Signal;var j=l._observers;var d=MochiKit.Base;if(arguments.length>1){var a=MochiKit.DOM.getElement(arguments[0]);var n=arguments[1];var g=arguments[2];var c=arguments[3];for(var f=j.length-1;f>=0;f--){var b=j[f];if(b[0]===a&&b[1]===n&&b[4]===g&&b[5]===c){l._disconnect(b);j.splice(f,1);return true}}}else{var k=d.findIdentical(j,h);if(k>=0){l._disconnect(h);j.splice(k,1);return true}}return false},disconnectAll:function(a,l){a=MochiKit.DOM.getElement(a);var b=MochiKit.Base;var c=b.flattenArguments(b.extend(null,arguments,1));var j=MochiKit.Signal;var h=j._disconnect;var g=j._observers;if(c.length===0){for(var f=g.length-1;f>=0;f--){var d=g[f];if(d[0]===a){h(d);g.splice(f,1)}}}else{var k={};for(var f=0;f<c.length;f++){k[c[f]]=true}for(var f=g.length-1;f>=0;f--){var d=g[f];if(d[0]===a&&d[1] in k){h(d);g.splice(f,1)}}}},signal:function(h,g){var f=MochiKit.Signal._observers;h=MochiKit.DOM.getElement(h);var a=MochiKit.Base.extend(null,arguments,2);var j=[];for(var b=0;b<f.length;b++){var c=f[b];if(c[0]===h&&c[1]===g){try{c[2].apply(h,a)}catch(d){j.push(d)}}}if(j.length==1){throw j[0]}else{if(j.length>1){var d=new Error("Multiple errors thrown in handling 'sig', see errors property");d.errors=j;throw d}}}});MochiKit.Signal.EXPORT_OK=[];MochiKit.Signal.EXPORT=["connect","disconnect","signal","disconnectAll"];MochiKit.Signal.__new__=function(c){var a=MochiKit.Base;this._document=document;this._window=c;try{this.connect(window,"onunload",this._unloadCache)}catch(b){}this.EXPORT_TAGS={":common":this.EXPORT,":all":a.concat(this.EXPORT,this.EXPORT_OK)};a.nameFunctions(this)};MochiKit.Signal.__new__(this);if(MochiKit.__export__){connect=MochiKit.Signal.connect;disconnect=MochiKit.Signal.disconnect;disconnectAll=MochiKit.Signal.disconnectAll;signal=MochiKit.Signal.signal}MochiKit.Base._exportSymbols(this,MochiKit.Signal);