if(typeof(dojo)!="undefined"){dojo.provide("MochiKit.Iter");dojo.require("MochiKit.Base")}if(typeof(JSAN)!="undefined"){JSAN.use("MochiKit.Base",[])}try{if(typeof(MochiKit.Base)=="undefined"){throw""}}catch(e){throw"MochiKit.Iter depends on MochiKit.Base!"}if(typeof(MochiKit.Iter)=="undefined"){MochiKit.Iter={}}MochiKit.Iter.NAME="MochiKit.Iter";MochiKit.Iter.VERSION="1.4";MochiKit.Base.update(MochiKit.Iter,{__repr__:function(){return"["+this.NAME+" "+this.VERSION+"]"},toString:function(){return this.__repr__()},registerIteratorFactory:function(b,a,d,c){MochiKit.Iter.iteratorRegistry.register(b,a,d,c)},iter:function(d,c){var b=MochiKit.Iter;if(arguments.length==2){return b.takewhile(function(g){return g!=c},d)}if(typeof(d.next)=="function"){return d}else{if(typeof(d.iter)=="function"){return d.iter()}}try{return b.iteratorRegistry.match(d)}catch(f){var a=MochiKit.Base;if(f==a.NotFound){f=new TypeError(typeof(d)+": "+a.repr(d)+" is not iterable")}throw f}},count:function(b){if(!b){b=0}var a=MochiKit.Base;return{repr:function(){return"count("+b+")"},toString:a.forwardCall("repr"),next:a.counter(b)}},cycle:function(f){var c=MochiKit.Iter;var b=MochiKit.Base;var a=[];var d=c.iter(f);return{repr:function(){return"cycle(...)"},toString:b.forwardCall("repr"),next:function(){try{var j=d.next();a.push(j);return j}catch(h){if(h!=c.StopIteration){throw h}if(a.length===0){this.next=function(){throw c.StopIteration}}else{var g=-1;this.next=function(){g=(g+1)%a.length;return a[g]}}return this.next()}}}},repeat:function(b,c){var a=MochiKit.Base;if(typeof(c)=="undefined"){return{repr:function(){return"repeat("+a.repr(b)+")"},toString:a.forwardCall("repr"),next:function(){return b}}}return{repr:function(){return"repeat("+a.repr(b)+", "+c+")"},toString:a.forwardCall("repr"),next:function(){if(c<=0){throw MochiKit.Iter.StopIteration}c-=1;return b}}},next:function(a){return a.next()},izip:function(g,f){var a=MochiKit.Base;var c=MochiKit.Iter;var d=c.next;var b=a.map(c.iter,arguments);return{repr:function(){return"izip(...)"},toString:a.forwardCall("repr"),next:function(){return a.map(d,b)}}},ifilter:function(c,b){var a=MochiKit.Base;b=MochiKit.Iter.iter(b);if(c===null){c=a.operator.truth}return{repr:function(){return"ifilter(...)"},toString:a.forwardCall("repr"),next:function(){while(true){var d=b.next();if(c(d)){return d}}return undefined}}},ifilterfalse:function(c,b){var a=MochiKit.Base;b=MochiKit.Iter.iter(b);if(c===null){c=a.operator.truth}return{repr:function(){return"ifilterfalse(...)"},toString:a.forwardCall("repr"),next:function(){while(true){var d=b.next();if(!c(d)){return d}}return undefined}}},islice:function(c){var b=MochiKit.Iter;var a=MochiKit.Base;c=b.iter(c);var h=0;var f=0;var g=1;var d=-1;if(arguments.length==2){f=arguments[1]}else{if(arguments.length==3){h=arguments[1];f=arguments[2]}else{h=arguments[1];f=arguments[2];g=arguments[3]}}return{repr:function(){return"islice("+["...",h,f,g].join(", ")+")"},toString:a.forwardCall("repr"),next:function(){var i;while(d<h){i=c.next();d++}if(h>=f){throw b.StopIteration}h+=g;return i}}},imap:function(c,i,g){var a=MochiKit.Base;var d=MochiKit.Iter;var b=a.map(d.iter,a.extend(null,arguments,1));var h=a.map;var f=d.next;return{repr:function(){return"imap(...)"},toString:a.forwardCall("repr"),next:function(){return c.apply(this,h(f,b))}}},applymap:function(b,d,c){d=MochiKit.Iter.iter(d);var a=MochiKit.Base;return{repr:function(){return"applymap(...)"},toString:a.forwardCall("repr"),next:function(){return b.apply(c,d.next())}}},chain:function(f,d){var c=MochiKit.Iter;var b=MochiKit.Base;if(arguments.length==1){return c.iter(arguments[0])}var a=b.map(c.iter,arguments);return{repr:function(){return"chain(...)"},toString:b.forwardCall("repr"),next:function(){while(a.length>1){try{return a[0].next()}catch(h){if(h!=c.StopIteration){throw h}a.shift()}}if(a.length==1){var g=a.shift();this.next=b.bind("next",g);return this.next()}throw c.StopIteration}}},takewhile:function(c,b){var a=MochiKit.Iter;b=a.iter(b);return{repr:function(){return"takewhile(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){var d=b.next();if(!c(d)){this.next=function(){throw a.StopIteration};this.next()}return d}}},dropwhile:function(c,b){b=MochiKit.Iter.iter(b);var a=MochiKit.Base;var d=a.bind;return{repr:function(){return"dropwhile(...)"},toString:a.forwardCall("repr"),next:function(){while(true){var f=b.next();if(!c(f)){break}}this.next=d("next",b);return f}}},_tee:function(f,c,d){c.pos[f]=-1;var a=MochiKit.Base;var b=a.listMin;return{repr:function(){return"tee("+f+", ...)"},toString:a.forwardCall("repr"),next:function(){var h;var g=c.pos[f];if(g==c.max){h=d.next();c.deque.push(h);c.max+=1;c.pos[f]+=1}else{h=c.deque[g-c.min];c.pos[f]+=1;if(g==c.min&&b(c.pos)!=c.min){c.min+=1;c.deque.shift()}}return h}}},tee:function(f,h){var g=[];var d={pos:[],deque:[],max:-1,min:-1};if(arguments.length==1||typeof(h)=="undefined"||h===null){h=2}var b=MochiKit.Iter;f=b.iter(f);var a=b._tee;for(var c=0;c<h;c++){g.push(a(c,d,f))}return g},list:function(c){var a=MochiKit.Base;if(typeof(c.slice)=="function"){return c.slice()}else{if(a.isArrayLike(c)){return a.concat(c)}}var b=MochiKit.Iter;c=b.iter(c);var f=[];try{while(true){f.push(c.next())}}catch(d){if(d!=b.StopIteration){throw d}return f}return undefined},reduce:function(f,g,c){var d=0;var a=c;var b=MochiKit.Iter;g=b.iter(g);if(arguments.length<3){try{a=g.next()}catch(h){if(h==b.StopIteration){h=new TypeError("reduce() of empty sequence with no initial value")}throw h}d++}try{while(true){a=f(a,g.next())}}catch(h){if(h!=b.StopIteration){throw h}}return a},range:function(){var c=0;var a=0;var b=1;if(arguments.length==1){a=arguments[0]}else{if(arguments.length==2){c=arguments[0];a=arguments[1]}else{if(arguments.length==3){c=arguments[0];a=arguments[1];b=arguments[2]}else{throw new TypeError("range() takes 1, 2, or 3 arguments!")}}}if(b===0){throw new TypeError("range() step must not be 0")}return{next:function(){if((b>0&&c>=a)||(b<0&&c<=a)){throw MochiKit.Iter.StopIteration}var d=c;c+=b;return d},repr:function(){return"range("+[c,a,b].join(", ")+")"},toString:MochiKit.Base.forwardCall("repr")}},sum:function(c,f){if(typeof(f)=="undefined"||f===null){f=0}var a=f;var b=MochiKit.Iter;c=b.iter(c);try{while(true){a+=c.next()}}catch(d){if(d!=b.StopIteration){throw d}}return a},exhaust:function(b){var a=MochiKit.Iter;b=a.iter(b);try{while(true){b.next()}}catch(c){if(c!=a.StopIteration){throw c}}},forEach:function(f,d,b){var a=MochiKit.Base;if(arguments.length>2){d=a.bind(d,b)}if(a.isArrayLike(f)){try{for(var c=0;c<f.length;c++){d(f[c])}}catch(g){if(g!=MochiKit.Iter.StopIteration){throw g}}}else{b=MochiKit.Iter;b.exhaust(b.imap(d,f))}},every:function(c,b){var a=MochiKit.Iter;try{a.ifilterfalse(b,c).next();return false}catch(d){if(d!=a.StopIteration){throw d}return true}},sorted:function(b,a){var c=MochiKit.Iter.list(b);if(arguments.length==1){a=MochiKit.Base.compare}c.sort(a);return c},reversed:function(a){var b=MochiKit.Iter.list(a);b.reverse();return b},some:function(c,b){var a=MochiKit.Iter;try{a.ifilter(b,c).next();return true}catch(d){if(d!=a.StopIteration){throw d}return false}},iextend:function(a,d){if(MochiKit.Base.isArrayLike(d)){for(var c=0;c<d.length;c++){a.push(d[c])}}else{var b=MochiKit.Iter;d=b.iter(d);try{while(true){a.push(d.next())}}catch(f){if(f!=b.StopIteration){throw f}}}return a},groupby:function(c,i){var d=MochiKit.Base;var l=MochiKit.Iter;if(arguments.length<2){i=d.operator.identity}c=l.iter(c);var g=undefined;var f=undefined;var j;function a(){j=c.next();f=i(j)}function b(){var k=j;j=undefined;return k}var h=true;return{repr:function(){return"groupby(...)"},next:function(){while(f==g){a();if(h){h=false;break}}g=f;return[f,{next:function(){if(j==undefined){a()}if(f!=g){throw l.StopIteration}return b()}}]}}},groupby_as_array:function(a,g){var b=MochiKit.Base;var k=MochiKit.Iter;if(arguments.length<2){g=b.operator.identity}a=k.iter(a);var l=[];var c=true;var d;while(true){try{var h=a.next();var j=g(h)}catch(f){if(f==k.StopIteration){break}throw f}if(c||j!=d){var i=[];l.push([j,i])}i.push(h);c=false;d=j}return l},arrayLikeIter:function(b){var a=0;return{repr:function(){return"arrayLikeIter(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){if(a>=b.length){throw MochiKit.Iter.StopIteration}return b[a++]}}},hasIterateNext:function(a){return(a&&typeof(a.iterateNext)=="function")},iterateNextIter:function(a){return{repr:function(){return"iterateNextIter(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){var b=a.iterateNext();if(b===null||b===undefined){throw MochiKit.Iter.StopIteration}return b}}}});MochiKit.Iter.EXPORT_OK=["iteratorRegistry","arrayLikeIter","hasIterateNext","iterateNextIter",];MochiKit.Iter.EXPORT=["StopIteration","registerIteratorFactory","iter","count","cycle","repeat","next","izip","ifilter","ifilterfalse","islice","imap","applymap","chain","takewhile","dropwhile","tee","list","reduce","range","sum","exhaust","forEach","every","sorted","reversed","some","iextend","groupby","groupby_as_array"];MochiKit.Iter.__new__=function(){var a=MochiKit.Base;if(typeof(StopIteration)!="undefined"){this.StopIteration=StopIteration}else{this.StopIteration=new a.NamedError("StopIteration")}this.iteratorRegistry=new a.AdapterRegistry();this.registerIteratorFactory("arrayLike",a.isArrayLike,this.arrayLikeIter);this.registerIteratorFactory("iterateNext",this.hasIterateNext,this.iterateNextIter);this.EXPORT_TAGS={":common":this.EXPORT,":all":a.concat(this.EXPORT,this.EXPORT_OK)};a.nameFunctions(this)};MochiKit.Iter.__new__();if(MochiKit.__export__){reduce=MochiKit.Iter.reduce}MochiKit.Base._exportSymbols(this,MochiKit.Iter);