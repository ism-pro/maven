if(typeof(dojo)!="undefined"){dojo.provide("MochiKit.Logging");dojo.require("MochiKit.Base")}if(typeof(JSAN)!="undefined"){JSAN.use("MochiKit.Base",[])}try{if(typeof(MochiKit.Base)=="undefined"){throw""}}catch(e){throw"MochiKit.Logging depends on MochiKit.Base!"}if(typeof(MochiKit.Logging)=="undefined"){MochiKit.Logging={}}MochiKit.Logging.NAME="MochiKit.Logging";MochiKit.Logging.VERSION="1.4";MochiKit.Logging.__repr__=function(){return"["+this.NAME+" "+this.VERSION+"]"};MochiKit.Logging.toString=function(){return this.__repr__()};MochiKit.Logging.EXPORT=["LogLevel","LogMessage","Logger","alertListener","logger","log","logError","logDebug","logFatal","logWarning"];MochiKit.Logging.EXPORT_OK=["logLevelAtLeast","isLogMessage","compareLogMessage"];MochiKit.Logging.LogMessage=function(a,c,b){this.num=a;this.level=c;this.info=b;this.timestamp=new Date()};MochiKit.Logging.LogMessage.prototype={repr:function(){var a=MochiKit.Base;return"LogMessage("+a.map(a.repr,[this.num,this.level,this.info]).join(", ")+")"},toString:MochiKit.Base.forwardCall("repr")};MochiKit.Base.update(MochiKit.Logging,{logLevelAtLeast:function(b){var a=MochiKit.Logging;if(typeof(b)=="string"){b=a.LogLevel[b]}return function(d){var c=d.level;if(typeof(c)=="string"){c=a.LogLevel[c]}return c>=b}},isLogMessage:function(){var b=MochiKit.Logging.LogMessage;for(var a=0;a<arguments.length;a++){if(!(arguments[a] instanceof b)){return false}}return true},compareLogMessage:function(d,c){return MochiKit.Base.compare([d.level,d.info],[c.level,c.info])},alertListener:function(a){alert("num: "+a.num+"\nlevel: "+a.level+"\ninfo: "+a.info.join(" "))}});MochiKit.Logging.Logger=function(a){this.counter=0;if(typeof(a)=="undefined"||a===null){a=-1}this.maxSize=a;this._messages=[];this.listeners={};this.useNativeConsole=false};MochiKit.Logging.Logger.prototype={clear:function(){this._messages.splice(0,this._messages.length)},logToConsole:function(a){if(typeof(window)!="undefined"&&window.console&&window.console.log){window.console.log(a.replace(/%/g,"\uFF05"))}else{if(typeof(opera)!="undefined"&&opera.postError){opera.postError(a)}else{if(typeof(printfire)=="function"){printfire(a)}else{if(typeof(Debug)!="undefined"&&Debug.writeln){Debug.writeln(a)}else{if(typeof(debug)!="undefined"&&debug.trace){debug.trace(a)}}}}}},dispatchListeners:function(c){for(var a in this.listeners){var b=this.listeners[a];if(b.ident!=a||(b[0]&&!b[0](c))){continue}b[1](c)}},addListener:function(d,a,c){if(typeof(a)=="string"){a=MochiKit.Logging.logLevelAtLeast(a)}var b=[a,c];b.ident=d;this.listeners[d]=b},removeListener:function(a){delete this.listeners[a]},baseLog:function(c,a){var b=new MochiKit.Logging.LogMessage(this.counter,c,MochiKit.Base.extend(null,arguments,1));this._messages.push(b);this.dispatchListeners(b);if(this.useNativeConsole){this.logToConsole(b.level+": "+b.info.join(" "))}this.counter+=1;while(this.maxSize>=0&&this._messages.length>this.maxSize){this._messages.shift()}},getMessages:function(a){var b=0;if(!(typeof(a)=="undefined"||a===null)){b=Math.max(0,this._messages.length-a)}return this._messages.slice(b)},getMessageText:function(b){if(typeof(b)=="undefined"||b===null){b=30}var c=this.getMessages(b);if(c.length){var a=map(function(d){return"\n  ["+d.num+"] "+d.level+": "+d.info.join(" ")},c);a.unshift("LAST "+c.length+" MESSAGES:");return a.join("")}return""},debuggingBookmarklet:function(a){if(typeof(MochiKit.LoggingPane)=="undefined"){alert(this.getMessageText())}else{MochiKit.LoggingPane.createLoggingPane(a||false)}}};MochiKit.Logging.__new__=function(){this.LogLevel={ERROR:40,FATAL:50,WARNING:30,INFO:20,DEBUG:10};var a=MochiKit.Base;a.registerComparator("LogMessage",this.isLogMessage,this.compareLogMessage);var d=a.partial;var c=this.Logger;var g=c.prototype.baseLog;a.update(this.Logger.prototype,{debug:d(g,"DEBUG"),log:d(g,"INFO"),error:d(g,"ERROR"),fatal:d(g,"FATAL"),warning:d(g,"WARNING")});var b=this;var f=function(h){return function(){b.logger[h].apply(b.logger,arguments)}};this.log=f("log");this.logError=f("error");this.logDebug=f("debug");this.logFatal=f("fatal");this.logWarning=f("warning");this.logger=new c();this.logger.useNativeConsole=true;this.EXPORT_TAGS={":common":this.EXPORT,":all":a.concat(this.EXPORT,this.EXPORT_OK)};a.nameFunctions(this)};if(typeof(printfire)=="undefined"&&typeof(document)!="undefined"&&document.createEvent&&typeof(dispatchEvent)!="undefined"){printfire=function(){printfire.args=arguments;var a=document.createEvent("Events");a.initEvent("printfire",false,true);dispatchEvent(a)}}MochiKit.Logging.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Logging);