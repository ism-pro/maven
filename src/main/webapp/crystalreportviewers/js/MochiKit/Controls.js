MochiKit.Base.update(MochiKit.Base,{ScriptFragment:"(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)",stripScripts:function(a){return a.replace(new RegExp(MochiKit.Base.ScriptFragment,"img"),"")},stripTags:function(a){return a.replace(/<\/?[^>]+>/gi,"")},extractScripts:function(c){var b=new RegExp(MochiKit.Base.ScriptFragment,"img");var a=new RegExp(MochiKit.Base.ScriptFragment,"im");return MochiKit.Base.map(function(d){return(d.match(a)||["",""])[1]},c.match(b)||[])},evalScripts:function(str){return MochiKit.Base.map(function(scr){eval(scr)},MochiKit.Base.extractScripts(str))}});MochiKit.Form={serialize:function(d){var e=MochiKit.Form.getElements(d);var c=[];for(var b=0;b<e.length;b++){var a=MochiKit.Form.serializeElement(e[b]);if(a){c.push(a)}}return c.join("&")},getElements:function(b){b=MochiKit.DOM.getElement(b);var c=[];for(tagName in MochiKit.Form.Serializers){var d=b.getElementsByTagName(tagName);for(var a=0;a<d.length;a++){c.push(d[a])}}return c},serializeElement:function(b){b=MochiKit.DOM.getElement(b);var d=b.tagName.toLowerCase();var c=MochiKit.Form.Serializers[d](b);if(c){var a=encodeURIComponent(c[0]);if(a.length===0){return}if(!(c[1] instanceof Array)){c[1]=[c[1]]}return c[1].map(function(e){return a+"="+encodeURIComponent(e)}).join("&")}}};MochiKit.Form.Serializers={input:function(a){switch(a.type.toLowerCase()){case"submit":case"hidden":case"password":case"text":return MochiKit.Form.Serializers.textarea(a);case"checkbox":case"radio":return MochiKit.Form.Serializers.inputSelector(a)}return false},inputSelector:function(a){if(a.checked){return[a.name,a.value]}},textarea:function(a){return[a.name,a.value]},select:function(a){return MochiKit.Form.Serializers[a.type=="select-one"?"selectOne":"selectMany"](a)},selectOne:function(c){var d="",b,a=c.selectedIndex;if(a>=0){b=c.options[a];d=b.value;if(!d&&!("value" in b)){d=b.text}}return[c.name,d]},selectMany:function(c){var d=[];for(var b=0;b<c.length;b++){var a=c.options[b];if(a.selected){var e=a.value;if(!e&&!("value" in a)){e=a.text}d.push(e)}}return[c.name,d]}};var Ajax={activeRequestCount:0};Ajax.Responders={responders:[],register:function(a){if(MochiKit.Base.find(this.responders,a)==-1){this.responders.push(a)}},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(d,b,c,a){MochiKit.Iter.forEach(this.responders,function(f){if(f[d]&&typeof(f[d])=="function"){try{f[d].apply(f,[b,c,a])}catch(g){}}})}};Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=function(){};Ajax.Base.prototype={setOptions:function(a){this.options={method:"post",asynchronous:true,parameters:""};MochiKit.Base.update(this.options,a||{})},responseIsSuccess:function(){return this.transport.status==undefined||this.transport.status===0||(this.transport.status>=200&&this.transport.status<300)},responseIsFailure:function(){return !this.responseIsSuccess()}};Ajax.Request=function(b,a){this.__init__(b,a)};Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];MochiKit.Base.update(Ajax.Request.prototype,Ajax.Base.prototype);MochiKit.Base.update(Ajax.Request.prototype,{__init__:function(b,a){this.transport=MochiKit.Async.getXMLHttpRequest();this.setOptions(a);this.request(b)},request:function(b){var c=this.options.parameters||"";if(c.length>0){c+="&_="}try{this.url=b;if(this.options.method=="get"&&c.length>0){this.url+=(this.url.match(/\?/)?"&":"?")+c}Ajax.Responders.dispatch("onCreate",this,this.transport);this.transport.open(this.options.method,this.url,this.options.asynchronous);if(this.options.asynchronous){this.transport.onreadystatechange=MochiKit.Base.bind(this.onStateChange,this);setTimeout(MochiKit.Base.bind(function(){this.respondToReadyState(1)},this),10)}this.setRequestHeaders();var a=this.options.postBody?this.options.postBody:c;this.transport.send(this.options.method=="post"?a:null)}catch(d){this.dispatchException(d)}},setRequestHeaders:function(){var b=["X-Requested-With","XMLHttpRequest"];if(this.options.method=="post"){b.push("Content-type","application/x-www-form-urlencoded");if(this.transport.overrideMimeType){b.push("Connection","close")}}if(this.options.requestHeaders){b.push.apply(b,this.options.requestHeaders)}for(var a=0;a<b.length;a+=2){this.transport.setRequestHeader(b[a],b[a+1])}},onStateChange:function(){var a=this.transport.readyState;if(a!=1){this.respondToReadyState(this.transport.readyState)}},header:function(a){try{return this.transport.getResponseHeader(a)}catch(b){}},evalJSON:function(){try{return eval(this.header("X-JSON"))}catch(e){}},evalResponse:function(){try{return eval(this.transport.responseText)}catch(e){this.dispatchException(e)}},respondToReadyState:function(a){var c=Ajax.Request.Events[a];var f=this.transport,b=this.evalJSON();if(c=="Complete"){try{(this.options["on"+this.transport.status]||this.options["on"+(this.responseIsSuccess()?"Success":"Failure")]||MochiKit.Base.noop)(f,b)}catch(d){this.dispatchException(d)}if((this.header("Content-type")||"").match(/^text\/javascript/i)){this.evalResponse()}}try{(this.options["on"+c]||MochiKit.Base.noop)(f,b);Ajax.Responders.dispatch("on"+c,this,f,b)}catch(d){this.dispatchException(d)}if(c=="Complete"){this.transport.onreadystatechange=MochiKit.Base.noop}},dispatchException:function(a){(this.options.onException||MochiKit.Base.noop)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Updater=function(a,c,b){this.__init__(a,c,b)};MochiKit.Base.update(Ajax.Updater.prototype,Ajax.Request.prototype);MochiKit.Base.update(Ajax.Updater.prototype,{__init__:function(a,c,b){this.containers={success:a.success?MochiKit.DOM.getElement(a.success):MochiKit.DOM.getElement(a),failure:a.failure?MochiKit.DOM.getElement(a.failure):(a.success?null:MochiKit.DOM.getElement(a))};this.transport=MochiKit.Async.getXMLHttpRequest();this.setOptions(b);var d=this.options.onComplete||MochiKit.Base.noop;this.options.onComplete=MochiKit.Base.bind(function(f,e){this.updateContent();d(f,e)},this);this.request(c)},updateContent:function(){var b=this.responseIsSuccess()?this.containers.success:this.containers.failure;var a=this.transport.responseText;if(!this.options.evalScripts){a=MochiKit.Base.stripScripts(a)}if(b){if(this.options.insertion){new this.options.insertion(b,a)}else{MochiKit.DOM.getElement(b).innerHTML=MochiKit.Base.stripScripts(a);setTimeout(function(){MochiKit.Base.evalScripts(a)},10)}}if(this.responseIsSuccess()){if(this.onComplete){setTimeout(MochiKit.Base.bind(this.onComplete,this),10)}}}});var Field={clear:function(){for(var a=0;a<arguments.length;a++){MochiKit.DOM.getElement(arguments[a]).value=""}},focus:function(a){MochiKit.DOM.getElement(a).focus()},present:function(){for(var a=0;a<arguments.length;a++){if(MochiKit.DOM.getElement(arguments[a]).value==""){return false}}return true},select:function(a){MochiKit.DOM.getElement(a).select()},activate:function(a){a=MochiKit.DOM.getElement(a);a.focus();if(a.select){a.select()}},scrollFreeActivate:function(a){setTimeout(function(){Field.activate(a)},1)}};var Autocompleter={};Autocompleter.Base=function(){};Autocompleter.Base.prototype={baseInitialize:function(b,c,a){this.element=MochiKit.DOM.getElement(b);this.update=MochiKit.DOM.getElement(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";MochiKit.Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight})}MochiKit.Visual.appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){MochiKit.Visual.fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}this.observer=null;this.element.setAttribute("autocomplete","off");MochiKit.Style.hideElement(this.update);MochiKit.Signal.connect(this.element,"onblur",this,this.onBlur);MochiKit.Signal.connect(this.element,"onkeypress",this,this.onKeyPress,this)},show:function(){if(MochiKit.DOM.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&MochiKit.Base.isIE()&&MochiKit.Base.isOpera()&&(MochiKit.DOM.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=MochiKit.DOM.getElement(this.update.id+"_iefix")}if(this.iefix){setTimeout(MochiKit.Base.bind(this.fixIEOverlapping,this),50)}},fixIEOverlapping:function(){MochiKit.Position.clone(this.update,this.iefix);this.iefix.style.zIndex=1;this.update.style.zIndex=2;MochiKit.Style.showElement(this.iefix)},hide:function(){this.stopIndicator();if(MochiKit.DOM.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){MochiKit.Style.hideElement(this.iefix)}},startIndicator:function(){if(this.options.indicator){MochiKit.Style.showElement(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){MochiKit.Style.hideElement(this.options.indicator)}},onKeyPress:function(a){if(this.active){if(a.keyString=="KEY_TAB"||a.keyString=="KEY_RETURN"){this.selectEntry();MochiKit.Event.stop(a)}else{if(a.keyString=="KEY_ESCAPE"){this.hide();this.active=false;MochiKit.Event.stop(a);return}else{if(a.keyString=="KEY_LEFT"||a.keyString=="KEY_RIGHT"){return}else{if(a.keyString=="KEY_UP"){this.markPrevious();this.render();if(MochiKit.Base.isSafari()){a.stop()}return}else{if(a.keyString=="KEY_DOWN"){this.markNext();this.render();if(MochiKit.Base.isSafari()){a.stop()}return}}}}}}else{if(a.keyString=="KEY_TAB"||a.keyString=="KEY_RETURN"){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(MochiKit.Base.bind(this.onObserverEvent,this),this.options.frequency*1000)},findElement:function(c,b){var a=c.target;while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},onHover:function(b){var a=this.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}b.stop()},onClick:function(b){var a=this.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(MochiKit.Base.bind(this.hide,this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?MochiKit.DOM.addElementClass(this.getEntry(a),"selected"):MochiKit.DOM.removeElementClass(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},collectTextNodesIgnoreClass:function(a,b){return MochiKit.Base.flattenArray(MochiKit.Base.map(function(c){if(c.nodeType==3){return c.nodeValue}else{if(c.hasChildNodes()&&!MochiKit.DOM.hasElementClass(c,b)){return this.collectTextNodesIgnoreClass(c,b)}}return""},MochiKit.DOM.getElement(a).childNodes)).join("")},updateElement:function(f){if(this.options.updateElement){this.options.updateElement(f);return}var c="";if(this.options.select){var a=document.getElementsByClassName(this.options.select,f)||[];if(a.length>0){c=MochiKit.DOM.scrapeText(a[0])}}else{c=this.collectTextNodesIgnoreClass(f,"informal")}var e=this.findLastToken();if(e!=-1){var d=this.element.value.substr(0,e+1);var b=this.element.value.substr(e+1).match(/^\s+/);if(b){d+=b[0]}this.element.value=d+c}else{this.element.value=c}this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,f)}},updateChoices:function(e){if(!this.changed&&this.hasFocus){this.update.innerHTML=e;var c=MochiKit.DOM;c.removeEmptyTextNodes(this.update);c.removeEmptyTextNodes(this.update.firstChild);if(this.update.firstChild&&this.update.firstChild.childNodes){this.entryCount=this.update.firstChild.childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;this.render()}},addObservers:function(a){MochiKit.Signal.connect(a,"onmouseover",this,this.onHover);MochiKit.Signal.connect(a,"onclick",this,this.onClick)},onObserverEvent:function(){this.changed=false;if(this.getToken().length>=this.options.minChars){this.startIndicator();this.getUpdatedChoices()}else{this.active=false;this.hide()}},getToken:function(){var b=this.findLastToken();if(b!=-1){var a=this.element.value.substr(b+1).replace(/^\s+/,"").replace(/\s+$/,"")}else{var a=this.element.value}return/\n/.test(a)?"":a},findLastToken:function(){var c=-1;for(var b=0;b<this.options.tokens.length;b++){var a=this.element.value.lastIndexOf(this.options.tokens[b]);if(a>c){c=a}}return c}};Ajax.Autocompleter=function(c,d,b,a){this.__init__(c,d,b,a)};MochiKit.Base.update(Ajax.Autocompleter.prototype,Autocompleter.Base.prototype);MochiKit.Base.update(Ajax.Autocompleter.prototype,{__init__:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=MochiKit.Base.bind(this.onComplete,this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=function(b,d,c,a){this.__init__(b,d,c,a)};MochiKit.Base.update(Autocompleter.Local.prototype,Autocompleter.Base.prototype);MochiKit.Base.update(Autocompleter.Local.prototype,{__init__:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=MochiKit.Base.update({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var h=b.getToken();var g=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var f=b.options.array[e];var j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase()):f.indexOf(h);while(j!=-1){if(j===0&&f.length!=h.length){d.push("<li><strong>"+f.substr(0,h.length)+"</strong>"+f.substr(h.length)+"</li>");break}else{if(h.length>=b.options.partialChars&&b.options.partialSearch&&j!=-1){if(b.options.fullSearch||/\s/.test(f.substr(j-1,1))){c.push("<li>"+f.substr(0,j)+"<strong>"+f.substr(j,h.length)+"</strong>"+f.substr(j+h.length)+"</li>");break}}}j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase(),j+1):f.indexOf(h,j+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Ajax.InPlaceEditor=function(c,b,a){this.__init__(c,b,a)};Ajax.InPlaceEditor.defaultHighlightColor="#FFFF99";Ajax.InPlaceEditor.prototype={__init__:function(c,b,a){this.url=b;this.element=MochiKit.DOM.getElement(c);this.options=MochiKit.Base.update({okButton:true,okText:"ok",cancelLink:true,cancelText:"cancel",savingText:"Saving...",clickToEditText:"Click to edit",okText:"ok",rows:1,onComplete:function(e,d){new MochiKit.Visual.Highlight(d,{startcolor:this.options.highlightcolor})},onFailure:function(d){alert("Error communicating with the server: "+MochiKit.Base.stripTags(d.responseText))},callback:function(d){return MochiKit.DOM.formContents(d)},handleLineBreaks:true,loadingText:"Loading...",savingClassName:"inplaceeditor-saving",loadingClassName:"inplaceeditor-loading",formClassName:"inplaceeditor-form",highlightcolor:Ajax.InPlaceEditor.defaultHighlightColor,highlightendcolor:"#FFFFFF",externalControl:null,submitOnBlur:false,ajaxOptions:{}},a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if(MochiKit.DOM.getElement(this.options.formId)){this.options.formId=null}}if(this.options.externalControl){this.options.externalControl=MochiKit.DOM.getElement(this.options.externalControl)}this.originalBackground=MochiKit.DOM.getStyle(this.element,"background-color");if(!this.originalBackground){this.originalBackground="transparent"}this.element.title=this.options.clickToEditText;this.onclickListener=MochiKit.Signal.connect(this.element,"onclick",this,this.enterEditMode);this.mouseoverListener=MochiKit.Signal.connect(this.element,"onmouseover",this,this.enterHover);this.mouseoutListener=MochiKit.Signal.connect(this.element,"onmouseout",this,this.leaveHover);if(this.options.externalControl){this.onclickListenerExternal=MochiKit.Signal.connect(this.options.externalControl,"onclick",this,this.enterEditMode);this.mouseoverListenerExternal=MochiKit.Signal.connect(this.options.externalControl,"onmouseover",this,this.enterHover);this.mouseoutListenerExternal=MochiKit.Signal.connect(this.options.externalControl,"onmouseout",this,this.leaveHover)}},enterEditMode:function(a){if(this.saving){return}if(this.editing){return}this.editing=true;this.onEnterEditMode();if(this.options.externalControl){MochiKit.Style.hideElement(this.options.externalControl)}MochiKit.Style.hideElement(this.element);this.createForm();this.element.parentNode.insertBefore(this.form,this.element);Field.scrollFreeActivate(this.editField);if(a){a.stop()}return false},createForm:function(){this.form=document.createElement("form");this.form.id=this.options.formId;MochiKit.DOM.addElementClass(this.form,this.options.formClassName);this.form.onsubmit=MochiKit.Base.bind(this.onSubmit,this);this.createEditField();if(this.options.textarea){var a=document.createElement("br");this.form.appendChild(a)}if(this.options.okButton){okButton=document.createElement("input");okButton.type="submit";okButton.value=this.options.okText;this.form.appendChild(okButton)}if(this.options.cancelLink){cancelLink=document.createElement("a");cancelLink.href="#";cancelLink.appendChild(document.createTextNode(this.options.cancelText));cancelLink.onclick=MochiKit.Base.bind(this.onclickCancel,this);this.form.appendChild(cancelLink)}},hasHTMLLineBreaks:function(a){if(!this.options.handleLineBreaks){return false}return a.match(/<br/i)||a.match(/<p>/i)},convertHTMLLineBreaks:function(a){return a.replace(/<br>/gi,"\n").replace(/<br\/>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<p>/gi,"")},createEditField:function(){var e;if(this.options.loadTextURL){e=this.options.loadingText}else{e=this.getText()}var c=this;if(this.options.rows==1&&!this.hasHTMLLineBreaks(e)){this.options.textarea=false;var a=document.createElement("input");a.obj=this;a.type="text";a.name="value";a.value=e;a.style.backgroundColor=this.options.highlightcolor;var b=this.options.size||this.options.cols||0;if(b!==0){a.size=b}if(this.options.submitOnBlur){a.onblur=MochiKit.Base.bind(this.onSubmit,this)}this.editField=a}else{this.options.textarea=true;var d=document.createElement("textarea");d.obj=this;d.name="value";d.value=this.convertHTMLLineBreaks(e);d.rows=this.options.rows;d.cols=this.options.cols||40;if(this.options.submitOnBlur){d.onblur=MochiKit.Base.bind(this.onSubmit,this)}this.editField=d}if(this.options.loadTextURL){this.loadExternalText()}this.form.appendChild(this.editField)},getText:function(){return this.element.innerHTML},loadExternalText:function(){MochiKit.DOM.addElementClass(this.form,this.options.loadingClassName);this.editField.disabled=true;new Ajax.Request(this.options.loadTextURL,MochiKit.Base.update({asynchronous:true,onComplete:MochiKit.Base.bind(this.onLoadedExternalText,this)},this.options.ajaxOptions))},onLoadedExternalText:function(a){MochiKit.DOM.removeElementClass(this.form,this.options.loadingClassName);this.editField.disabled=false;this.editField.value=MochiKit.Base.stripTags(a)},onclickCancel:function(){this.onComplete();this.leaveEditMode();return false},onFailure:function(a){this.options.onFailure(a);if(this.oldInnerHTML){this.element.innerHTML=this.oldInnerHTML;this.oldInnerHTML=null}return false},onSubmit:function(){var a=this.form;var b=this.editField.value;this.onLoading();new Ajax.Updater({success:this.element,failure:null},this.url,MochiKit.Base.update({parameters:this.options.callback(a,b),onComplete:MochiKit.Base.bind(this.onComplete,this),onFailure:MochiKit.Base.bind(this.onFailure,this)},this.options.ajaxOptions));if(arguments.length>1){arguments[0].stop()}return false},onLoading:function(){this.saving=true;this.removeForm();this.leaveHover();this.showSaving()},showSaving:function(){this.oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;MochiKit.DOM.addElementClass(this.element,this.options.savingClassName);this.element.style.backgroundColor=this.originalBackground;MochiKit.Style.showElement(this.element)},removeForm:function(){if(this.form){if(this.form.parentNode){MochiKit.DOM.removeElement(this.form)}this.form=null}},enterHover:function(){if(this.saving){return}this.element.style.backgroundColor=this.options.highlightcolor;if(this.effect){this.effect.cancel()}MochiKit.DOM.addElementClass(this.element,this.options.hoverClassName)},leaveHover:function(){if(this.options.backgroundColor){this.element.style.backgroundColor=this.oldBackground}MochiKit.DOM.removeElementClass(this.element,this.options.hoverClassName);if(this.saving){return}this.effect=new MochiKit.Visual.Highlight(this.element,{startcolor:this.options.highlightcolor,endcolor:this.options.highlightendcolor,restorecolor:this.originalBackground})},leaveEditMode:function(){MochiKit.DOM.removeElementClass(this.element,this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this.originalBackground;MochiKit.Style.showElement(this.element);if(this.options.externalControl){MochiKit.Style.showElement(this.options.externalControl)}this.editing=false;this.saving=false;this.oldInnerHTML=null;this.onLeaveEditMode()},onComplete:function(a){this.leaveEditMode();MochiKit.Base.bind(this.options.onComplete,this)(a,this.element)},onEnterEditMode:function(){},onLeaveEditMode:function(){},dispose:function(){if(this.oldInnerHTML){this.element.innerHTML=this.oldInnerHTML}this.leaveEditMode();MochiKit.Signal.disconnect(this.onclickListener);MochiKit.Signal.disconnect(this.mouseoverListener);MochiKit.Signal.disconnect(this.mouseoutListener);if(this.options.externalControl){MochiKit.Signal.disconnect(this.onclickListenerExternal);MochiKit.Signal.disconnect(this.mouseoverListenerExternal);MochiKit.Signal.disconnect(this.mouseoutListenerExternal)}}};