if(typeof(dojo)!="undefined"){dojo.provide("MochiKit.LoggingPane");dojo.require("MochiKit.Logging");dojo.require("MochiKit.Base")}if(typeof(JSAN)!="undefined"){JSAN.use("MochiKit.Logging",[]);JSAN.use("MochiKit.Base",[])}try{if(typeof(MochiKit.Base)=="undefined"||typeof(MochiKit.Logging)=="undefined"){throw""}}catch(e){throw"MochiKit.LoggingPane depends on MochiKit.Base and MochiKit.Logging!"}if(typeof(MochiKit.LoggingPane)=="undefined"){MochiKit.LoggingPane={}}MochiKit.LoggingPane.NAME="MochiKit.LoggingPane";MochiKit.LoggingPane.VERSION="1.4";MochiKit.LoggingPane.__repr__=function(){return"["+this.NAME+" "+this.VERSION+"]"};MochiKit.LoggingPane.toString=function(){return this.__repr__()};MochiKit.LoggingPane.createLoggingPane=function(b){var a=MochiKit.LoggingPane;b=!(!b);if(a._loggingPane&&a._loggingPane.inline!=b){a._loggingPane.closePane();a._loggingPane=null}if(!a._loggingPane||a._loggingPane.closed){a._loggingPane=new a.LoggingPane(b,MochiKit.Logging.logger)}return a._loggingPane};MochiKit.LoggingPane.LoggingPane=function(s,z){if(typeof(z)=="undefined"||z===null){z=MochiKit.Logging.logger}this.logger=z;var C=MochiKit.Base.update;var E=MochiKit.Base.updatetree;var g=MochiKit.Base.bind;var w=MochiKit.Base.clone;var I=window;var h="_MochiKit_LoggingPane";if(typeof(MochiKit.DOM)!="undefined"){I=MochiKit.DOM.currentWindow()}if(!s){var d=I.location.href.split("?")[0].replace(/[:\/.><&-]/g,"_");var r=h+"_"+d;var M=I.open("",r,"dependent,resizable,height=200");if(!M){alert("Not able to open debugging window due to pop-up blocking.");return undefined}M.document.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>[MochiKit.LoggingPane]</title></head><body></body></html>');M.document.close();M.document.title+=" "+I.document.title;I=M}var j=I.document;this.doc=j;var B=j.getElementById(h);var b=!!B;if(B&&typeof(B.loggingPane)!="undefined"){B.loggingPane.logger=this.logger;B.loggingPane.buildAndApplyFilter();return B.loggingPane}if(b){var i;while((i=B.firstChild)){B.removeChild(i)}}else{B=j.createElement("div");B.id=h}B.loggingPane=this;var f=j.createElement("input");var l=j.createElement("input");var D=j.createElement("button");var v=j.createElement("button");var x=j.createElement("button");var c=j.createElement("button");var k=j.createElement("div");var a=j.createElement("div");var K=h+"_Listener";this.colorTable=w(this.colorTable);var u=[];var F=null;var A=function(N){var O=N.level;if(typeof(O)=="number"){O=MochiKit.Logging.LogLevel[O]}return O};var H=function(N){return N.info.join(" ")};var y=g(function(P){var R=A(P);var O=H(P);var Q=this.colorTable[R];var N=j.createElement("span");N.className="MochiKit-LogMessage MochiKit-LogLevel-"+R;N.style.cssText="margin: 0px; white-space: -moz-pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; white-space: pre-line; word-wrap: break-word; wrap-option: emergency; color: "+Q;N.appendChild(j.createTextNode(R+": "+O));a.appendChild(N);a.appendChild(j.createElement("br"));if(k.offsetHeight>k.scrollHeight){k.scrollTop=0}else{k.scrollTop=k.scrollHeight}},this);var G=function(N){u[u.length]=N;y(N)};var t=function(){var O,P;try{O=new RegExp(f.value);P=new RegExp(l.value)}catch(N){logDebug("Error in filter regex: "+N.message);return null}return function(Q){return(O.test(A(Q))&&P.test(H(Q)))}};var o=function(){while(a.firstChild){a.removeChild(a.firstChild)}};var p=function(){u=[];o()};var m=g(function(){if(this.closed){return}this.closed=true;if(MochiKit.LoggingPane._loggingPane==this){MochiKit.LoggingPane._loggingPane=null}this.logger.removeListener(K);B.loggingPane=null;if(s){B.parentNode.removeChild(B)}else{this.win.close()}},this);var n=function(){o();for(var N=0;N<u.length;N++){var O=u[N];if(F===null||F(O)){y(O)}}};this.buildAndApplyFilter=function(){F=t();n();this.logger.removeListener(K);this.logger.addListener(K,F,G)};var q=g(function(){u=this.logger.getMessages();n()},this);var L=g(function(N){N=N||window.event;key=N.which||N.keyCode;if(key==13){this.buildAndApplyFilter()}},this);var J="display: block; z-index: 1000; left: 0px; bottom: 0px; position: fixed; width: 100%; background-color: white; font: "+this.logFont;if(s){J+="; height: 10em; border-top: 2px solid black"}else{J+="; height: 100%;"}B.style.cssText=J;if(!b){j.body.appendChild(B)}J={cssText:"width: 33%; display: inline; font: "+this.logFont};E(f,{value:"FATAL|ERROR|WARNING|INFO|DEBUG",onkeypress:L,style:J});B.appendChild(f);E(l,{value:".*",onkeypress:L,style:J});B.appendChild(l);J="width: 8%; display:inline; font: "+this.logFont;D.appendChild(j.createTextNode("Filter"));D.onclick=g("buildAndApplyFilter",this);D.style.cssText=J;B.appendChild(D);v.appendChild(j.createTextNode("Load"));v.onclick=q;v.style.cssText=J;B.appendChild(v);x.appendChild(j.createTextNode("Clear"));x.onclick=p;x.style.cssText=J;B.appendChild(x);c.appendChild(j.createTextNode("Close"));c.onclick=m;c.style.cssText=J;B.appendChild(c);k.style.cssText="overflow: auto; width: 100%";a.style.cssText="width: 100%; height: "+(s?"8em":"100%");k.appendChild(a);B.appendChild(k);this.buildAndApplyFilter();q();if(s){this.win=undefined}else{this.win=I}this.inline=s;this.closePane=m;this.closed=false;return this};MochiKit.LoggingPane.LoggingPane.prototype={logFont:"8pt Verdana,sans-serif",colorTable:{ERROR:"red",FATAL:"darkred",WARNING:"blue",INFO:"black",DEBUG:"green"}};MochiKit.LoggingPane.EXPORT_OK=["LoggingPane"];MochiKit.LoggingPane.EXPORT=["createLoggingPane"];MochiKit.LoggingPane.__new__=function(){this.EXPORT_TAGS={":common":this.EXPORT,":all":MochiKit.Base.concat(this.EXPORT,this.EXPORT_OK)};MochiKit.Base.nameFunctions(this);MochiKit.LoggingPane._loggingPane=null};MochiKit.LoggingPane.__new__();MochiKit.Base._exportSymbols(this,MochiKit.LoggingPane);