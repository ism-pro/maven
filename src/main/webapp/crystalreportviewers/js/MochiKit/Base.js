if(typeof(dojo)!="undefined"){dojo.provide("MochiKit.Base")}if(typeof(MochiKit)=="undefined"){MochiKit={}}if(typeof(MochiKit.Base)=="undefined"){MochiKit.Base={}}MochiKit.Base.VERSION="1.4";MochiKit.Base.NAME="MochiKit.Base";MochiKit.Base.update=function(b,d){if(b===null){b={}}for(var c=1;c<arguments.length;c++){var e=arguments[c];if(typeof(e)!="undefined"&&e!==null){for(var a in e){b[a]=e[a]}}}return b};MochiKit.Base.update(MochiKit.Base,{__repr__:function(){return"["+this.NAME+" "+this.VERSION+"]"},toString:function(){return this.__repr__()},camelize:function(b){var a=b.split("-");var d=a[0];for(var c=1;c<a.length;c++){d+=a[c].charAt(0).toUpperCase()+a[c].substring(1)}return d},counter:function(a){if(arguments.length===0){a=1}return function(){return a++}},clone:function(b){var a=arguments.callee;if(arguments.length==1){a.prototype=b;return new a()}},_flattenArray:function(c,a){for(var b=0;b<a.length;b++){var d=a[b];if(d instanceof Array){arguments.callee(c,d)}else{c.push(d)}}return c},flattenArray:function(a){return MochiKit.Base._flattenArray([],a)},flattenArguments:function(b){var e=[];var a=MochiKit.Base;var c=a.extend(null,arguments);while(c.length){var f=c.shift();if(f&&typeof(f)=="object"&&typeof(f.length)=="number"){for(var d=f.length-1;d>=0;d--){c.unshift(f[d])}}else{e.push(f)}}return e},extend:function(b,e,d){if(!d){d=0}if(e){var a=e.length;if(typeof(a)!="number"){if(typeof(MochiKit.Iter)!="undefined"){e=MochiKit.Iter.list(e);a=e.length}else{throw new TypeError("Argument not an array-like and MochiKit.Iter not present")}}if(!b){b=[]}for(var c=d;c<a;c++){b.push(e[c])}}return b},updatetree:function(c,e){if(c===null){c={}}for(var d=1;d<arguments.length;d++){var f=arguments[d];if(typeof(f)!="undefined"&&f!==null){for(var b in f){var a=f[b];if(typeof(c[b])=="object"&&typeof(a)=="object"){arguments.callee(c[b],a)}else{c[b]=a}}}}return c},setdefault:function(b,d){if(b===null){b={}}for(var c=1;c<arguments.length;c++){var e=arguments[c];for(var a in e){if(!(a in b)){b[a]=e[a]}}}return b},keys:function(b){var a=[];for(var c in b){a.push(c)}return a},items:function(d){var c=[];var b;for(var f in d){var a;try{a=d[f]}catch(b){continue}c.push([f,a])}return c},_newNamedError:function(b,a,c){c.prototype=new MochiKit.Base.NamedError(b.NAME+"."+a);b[a]=c},operator:{truth:function(b){return !!b},lognot:function(b){return !b},identity:function(b){return b},not:function(b){return ~b},neg:function(b){return -b},add:function(d,c){return d+c},sub:function(d,c){return d-c},div:function(d,c){return d/c},mod:function(d,c){return d%c},mul:function(d,c){return d*c},and:function(d,c){return d&c},or:function(d,c){return d|c},xor:function(d,c){return d^c},lshift:function(d,c){return d<<c},rshift:function(d,c){return d>>c},zrshift:function(d,c){return d>>>c},eq:function(d,c){return d==c},ne:function(d,c){return d!=c},gt:function(d,c){return d>c},ge:function(d,c){return d>=c},lt:function(d,c){return d<c},le:function(d,c){return d<=c},seq:function(d,c){return d===c},sne:function(d,c){return d!==c},ceq:function(d,c){return MochiKit.Base.compare(d,c)===0},cne:function(d,c){return MochiKit.Base.compare(d,c)!==0},cgt:function(d,c){return MochiKit.Base.compare(d,c)==1},cge:function(d,c){return MochiKit.Base.compare(d,c)!=-1},clt:function(d,c){return MochiKit.Base.compare(d,c)==-1},cle:function(d,c){return MochiKit.Base.compare(d,c)!=1},logand:function(d,c){return d&&c},logor:function(d,c){return d||c},contains:function(d,c){return c in d}},forwardCall:function(a){return function(){return this[a].apply(this,arguments)}},itemgetter:function(a){return function(b){return b[a]}},typeMatcher:function(){var b={};for(var a=0;a<arguments.length;a++){var c=arguments[a];b[c]=c}return function(){for(var d=0;d<arguments.length;d++){if(!(typeof(arguments[d]) in b)){return false}}return true}},isNull:function(){for(var a=0;a<arguments.length;a++){if(arguments[a]!==null){return false}}return true},isUndefinedOrNull:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!(typeof(b)=="undefined"||b===null)){return false}}return true},isEmpty:function(a){return !MochiKit.Base.isNotEmpty.apply(this,arguments)},isNotEmpty:function(b){for(var a=0;a<arguments.length;a++){var c=arguments[a];if(!(c&&c.length)){return false}}return true},isArrayLike:function(){for(var a=0;a<arguments.length;a++){var c=arguments[a];var b=typeof(c);if((b!="object"&&!(b=="function"&&typeof(c.item)=="function"))||c===null||typeof(c.length)!="number"||c.nodeType===3){return false}}return true},isDateLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(typeof(b)!="object"||b===null||typeof(b.getTime)!="function"){return false}}return true},xmap:function(b){if(b===null){return MochiKit.Base.extend(null,arguments,1)}var c=[];for(var a=1;a<arguments.length;a++){c.push(b(arguments[a]))}return c},map:function(n,f){var b=MochiKit.Base;var h=MochiKit.Iter;var o=b.isArrayLike;if(arguments.length<=2){if(!o(f)){if(h){f=h.list(f);if(n===null){return f}}else{throw new TypeError("Argument not an array-like and MochiKit.Iter not present")}}if(n===null){return b.extend(null,f)}var g=[];for(var e=0;e<f.length;e++){g.push(n(f[e]))}return g}else{if(n===null){n=Array}var a=null;for(e=1;e<arguments.length;e++){if(!o(arguments[e])){if(h){return h.list(h.imap.apply(null,arguments))}else{throw new TypeError("Argument not an array-like and MochiKit.Iter not present")}}var c=arguments[e].length;if(a===null||a>c){a=c}}g=[];for(e=0;e<a;e++){var k=[];for(var d=1;d<arguments.length;d++){k.push(arguments[d][e])}g.push(n.apply(this,k))}return g}},xfilter:function(b){var c=[];if(b===null){b=MochiKit.Base.operator.truth}for(var a=1;a<arguments.length;a++){var d=arguments[a];if(b(d)){c.push(d)}}return c},filter:function(e,b,c){var f=[];var a=MochiKit.Base;if(!a.isArrayLike(b)){if(MochiKit.Iter){b=MochiKit.Iter.list(b)}else{throw new TypeError("Argument not an array-like and MochiKit.Iter not present")}}if(e===null){e=a.operator.truth}if(typeof(Array.prototype.filter)=="function"){return Array.prototype.filter.call(b,e,c)}else{if(typeof(c)=="undefined"||c===null){for(var d=0;d<b.length;d++){var g=b[d];if(e(g)){f.push(g)}}}else{for(d=0;d<b.length;d++){g=b[d];if(e.call(c,g)){f.push(g)}}}}return f},_wrapDumbFunction:function(func){return function(){switch(arguments.length){case 0:return func();case 1:return func(arguments[0]);case 2:return func(arguments[0],arguments[1]);case 3:return func(arguments[0],arguments[1],arguments[2])}var args=[];for(var i=0;i<arguments.length;i++){args.push("arguments["+i+"]")}return eval("(func("+args.join(",")+"))")}},methodcaller:function(b){var a=MochiKit.Base.extend(null,arguments,1);if(typeof(b)=="function"){return function(c){return b.apply(c,a)}}else{return function(c){return c[b].apply(c,a)}}},method:function(b,c){var a=MochiKit.Base;return a.bind.apply(this,a.extend([c,b],arguments,2))},compose:function(b,f){var e=[];var a=MochiKit.Base;if(arguments.length===0){throw new TypeError("compose() requires at least one argument")}for(var c=0;c<arguments.length;c++){var d=arguments[c];if(typeof(d)!="function"){throw new TypeError(repr(d)+" is not a function")}e.push(d)}return function(){var g=arguments;for(var h=e.length-1;h>=0;h--){g=[e[h].apply(this,g)]}return g[0]}},bind:function(e,c){if(typeof(e)=="string"){e=c[e]}var d=e.im_func;var g=e.im_preargs;var b=e.im_self;var a=MochiKit.Base;if(typeof(e)=="function"&&typeof(e.apply)=="undefined"){e=a._wrapDumbFunction(e)}if(typeof(d)!="function"){d=e}if(typeof(c)!="undefined"){b=c}if(typeof(g)=="undefined"){g=[]}else{g=g.slice()}a.extend(g,arguments,2);var f=function(){var i=arguments;var j=arguments.callee;if(j.im_preargs.length>0){i=a.concat(j.im_preargs,i)}var h=j.im_self;if(!h){h=this}return j.im_func.apply(h,i)};f.im_self=b;f.im_func=d;f.im_preargs=g;return f},bindMethods:function(b){var d=MochiKit.Base.bind;for(var a in b){var c=b[a];if(typeof(c)=="function"){b[a]=d(c,b)}}},registerComparator:function(c,b,a,d){MochiKit.Base.comparatorRegistry.register(c,b,a,d)},_primitives:{"boolean":true,string:true,number:true},compare:function(i,d){if(i==d){return 0}var h=(typeof(i)=="undefined"||i===null);var j=(typeof(d)=="undefined"||d===null);if(h&&j){return 0}else{if(h){return -1}else{if(j){return 1}}}var c=MochiKit.Base;var g=c._primitives;if(!(typeof(i) in g&&typeof(d) in g)){try{return c.comparatorRegistry.match(i,d)}catch(k){if(k!=c.NotFound){throw k}}}if(i<d){return -1}else{if(i>d){return 1}}var f=c.repr;throw new TypeError(f(i)+" and "+f(d)+" can not be compared")},compareDateLike:function(d,c){return MochiKit.Base.compare(d.getTime(),c.getTime())},compareArrayLike:function(d,c){var h=MochiKit.Base.compare;var g=d.length;var j=0;if(g>c.length){j=1;g=c.length}else{if(g<c.length){j=-1}}for(var e=0;e<g;e++){var f=h(d[e],c[e]);if(f){return f}}return j},registerRepr:function(b,a,d,c){MochiKit.Base.reprRegistry.register(b,a,d,c)},repr:function(d){if(typeof(d)=="undefined"){return"undefined"}else{if(d===null){return"null"}}try{if(typeof(d.__repr__)=="function"){return d.__repr__()}else{if(typeof(d.repr)=="function"&&d.repr!=arguments.callee){return d.repr()}}return MochiKit.Base.reprRegistry.match(d)}catch(b){if(typeof(d.NAME)=="string"&&(d.toString==Function.prototype.toString||d.toString==Object.prototype.toString)){return d.NAME}}try{var c=(d+"")}catch(b){return"["+typeof(d)+"]"}if(typeof(d)=="function"){d=c.replace(/^\s+/,"");var a=d.indexOf("{");if(a!=-1){d=d.substr(0,a)+"{...}"}}return c},reprArrayLike:function(b){var a=MochiKit.Base;return"["+a.map(a.repr,b).join(", ")+"]"},reprString:function(a){return('"'+a.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},reprNumber:function(a){return a+""},registerJSON:function(b,a,d,c){MochiKit.Base.jsonRegistry.register(b,a,d,c)},evalJSON:function(){return eval("("+arguments[0]+")")},serializeJSON:function(a){var p=typeof(a);if(p=="undefined"){return"undefined"}else{if(p=="number"||p=="boolean"){return a+""}else{if(a===null){return"null"}}}var c=MochiKit.Base;var q=c.reprString;if(p=="string"){return q(a)}var n=arguments.callee;var f;if(typeof(a.__json__)=="function"){f=a.__json__();if(a!==f){return n(f)}}if(typeof(a.json)=="function"){f=a.json();if(a!==f){return n(f)}}if(p!="function"&&typeof(a.length)=="number"){var l=[];for(var h=0;h<a.length;h++){var b=n(a[h]);if(typeof(b)!="string"){b="undefined"}l.push(b)}return"["+l.join(", ")+"]"}try{f=c.jsonRegistry.match(a);if(a!==f){return n(f)}}catch(j){if(j!=c.NotFound){throw j}}if(p=="function"){return null}l=[];for(var d in a){var g;if(typeof(d)=="number"){g='"'+d+'"'}else{if(typeof(d)=="string"){g=q(d)}else{continue}}b=n(a[d]);if(typeof(b)!="string"){continue}l.push(g+":"+b)}return"{"+l.join(", ")+"}"},objEqual:function(d,c){return(MochiKit.Base.compare(d,c)===0)},arrayEqual:function(b,a){if(b.length!=a.length){return false}return(MochiKit.Base.compare(b,a)===0)},concat:function(){var b=[];var c=MochiKit.Base.extend;for(var a=0;a<arguments.length;a++){c(b,arguments[a])}return b},keyComparator:function(b){var a=MochiKit.Base;var d=a.compare;if(arguments.length==1){return function(f,e){return d(f[b],e[b])}}var c=a.extend(null,arguments);return function(f,e){var j=0;for(var h=0;(j===0)&&(h<c.length);h++){var g=c[h];j=d(f[g],e[g])}return j}},reverseKeyComparator:function(b){var a=MochiKit.Base.keyComparator.apply(this,arguments);return function(d,c){return a(c,d)}},partial:function(b){var a=MochiKit.Base;return a.bind.apply(this,a.extend([b,undefined],arguments,1))},listMinMax:function(f,a){if(a.length===0){return null}var e=a[0];var c=MochiKit.Base.compare;for(var b=1;b<a.length;b++){var d=a[b];if(c(d,e)==f){e=d}}return e},objMax:function(){return MochiKit.Base.listMinMax(1,arguments)},objMin:function(){return MochiKit.Base.listMinMax(-1,arguments)},findIdentical:function(a,d,e,b){if(typeof(b)=="undefined"||b===null){b=a.length}if(typeof(e)=="undefined"||e===null){e=0}for(var c=e;c<b;c++){if(a[c]===d){return c}}return -1},mean:function(){var d=0;var a=MochiKit.Base;var b=a.extend(null,arguments);var e=b.length;while(b.length){var f=b.shift();if(f&&typeof(f)=="object"&&typeof(f.length)=="number"){e+=f.length-1;for(var c=f.length-1;c>=0;c--){d+=f[c]}}else{d+=f}}if(e<=0){throw new TypeError("mean() requires at least one argument")}return d/e},median:function(){var b=MochiKit.Base.flattenArguments(arguments);if(b.length===0){throw new TypeError("median() requires at least one argument")}b.sort(compare);if(b.length%2==0){var a=b.length/2;return(b[a]+b[a-1])/2}else{return b[(b.length-1)/2]}},findValue:function(a,e,f,b){if(typeof(b)=="undefined"||b===null){b=a.length}if(typeof(f)=="undefined"||f===null){f=0}var d=MochiKit.Base.compare;for(var c=f;c<b;c++){if(d(a[c],e)===0){return c}}return -1},nodeWalk:function(c,d){var a=[c];var e=MochiKit.Base.extend;while(a.length){var b=d(a.shift());if(b){e(a,b)}}},nameFunctions:function(b){var c=b.NAME;if(typeof(c)=="undefined"){c=""}else{c=c+"."}for(var a in b){var f=b[a];if(typeof(f)=="function"&&typeof(f.NAME)=="undefined"){try{f.NAME=c+a}catch(d){}}}},queryString:function(h,j){if(typeof(MochiKit.DOM)!="undefined"&&arguments.length==1&&(typeof(h)=="string"||(typeof(h.nodeType)!="undefined"&&h.nodeType>0))){var g=MochiKit.DOM.formContents(h);h=g[0];j=g[1]}else{if(arguments.length==1){var a=h;h=[];j=[];for(var b in a){var l=a[b];if(typeof(l)!="function"){h.push(b);j.push(l)}}}}var e=[];var f=Math.min(h.length,j.length);var c=MochiKit.Base.urlEncode;for(var d=0;d<f;d++){l=j[d];if(typeof(l)!="undefined"&&l!==null){e.push(c(h[d])+"="+c(l))}}return e.join("&")},parseQueryString:function(h,j){var c=h.replace(/\+/g,"%20").split("&");var d={};var a;if(typeof(decodeURIComponent)!="undefined"){a=decodeURIComponent}else{a=unescape}if(j){for(var f=0;f<c.length;f++){var e=c[f].split("=");var b=a(e[0]);var g=d[b];if(!(g instanceof Array)){g=[];d[b]=g}g.push(a(e[1]))}}else{for(f=0;f<c.length;f++){e=c[f].split("=");d[a(e[0])]=a(e[1])}}return d}});MochiKit.Base.AdapterRegistry=function(){this.pairs=[]};MochiKit.Base.AdapterRegistry.prototype={register:function(b,a,d,c){if(c){this.pairs.unshift([b,a,d])}else{this.pairs.push([b,a,d])}},match:function(){for(var a=0;a<this.pairs.length;a++){var b=this.pairs[a];if(b[1].apply(this,arguments)){return b[2].apply(this,arguments)}}throw MochiKit.Base.NotFound},unregister:function(a){for(var b=0;b<this.pairs.length;b++){var c=this.pairs[b];if(c[0]==a){this.pairs.splice(b,1);return true}}return false}};MochiKit.Base.EXPORT=["flattenArray","noop","camelize","counter","clone","extend","update","updatetree","setdefault","keys","items","NamedError","operator","forwardCall","itemgetter","typeMatcher","isCallable","isUndefined","isUndefinedOrNull","isNull","isEmpty","isNotEmpty","isArrayLike","isDateLike","xmap","map","xfilter","filter","methodcaller","compose","bind","bindMethods","NotFound","AdapterRegistry","registerComparator","compare","registerRepr","repr","objEqual","arrayEqual","concat","keyComparator","reverseKeyComparator","partial","merge","listMinMax","listMax","listMin","objMax","objMin","nodeWalk","zip","urlEncode","queryString","serializeJSON","registerJSON","evalJSON","parseQueryString","findValue","findIdentical","flattenArguments","method","average","mean","median"];MochiKit.Base.EXPORT_OK=["nameFunctions","comparatorRegistry","reprRegistry","jsonRegistry","compareDateLike","compareArrayLike","reprArrayLike","reprString","reprNumber"];MochiKit.Base._exportSymbols=function(d,b){if(typeof(MochiKit.__export__)=="undefined"){MochiKit.__export__=(MochiKit.__compat__||(typeof(JSAN)=="undefined"&&typeof(dojo)=="undefined"))}if(!MochiKit.__export__){return}var c=b.EXPORT_TAGS[":all"];for(var a=0;a<c.length;a++){d[c[a]]=b[c[a]]}};MochiKit.Base.__new__=function(){var a=this;a.noop=a.operator.identity;a.forward=a.forwardCall;a.find=a.findValue;if(typeof(encodeURIComponent)!="undefined"){a.urlEncode=function(c){return encodeURIComponent(c).replace(/\'/g,"%27")}}else{a.urlEncode=function(c){return escape(c).replace(/\+/g,"%2B").replace(/\"/g,"%22").rval.replace(/\'/g,"%27")}}a.NamedError=function(c){this.message=c;this.name=c};a.NamedError.prototype=new Error();a.update(a.NamedError.prototype,{repr:function(){if(this.message&&this.message!=this.name){return this.name+"("+a.repr(this.message)+")"}else{return this.name+"()"}},toString:a.forwardCall("repr")});a.NotFound=new a.NamedError("MochiKit.Base.NotFound");a.listMax=a.partial(a.listMinMax,1);a.listMin=a.partial(a.listMinMax,-1);a.isCallable=a.typeMatcher("function");a.isUndefined=a.typeMatcher("undefined");a.merge=a.partial(a.update,null);a.zip=a.partial(a.map,null);a.average=a.mean;a.comparatorRegistry=new a.AdapterRegistry();a.registerComparator("dateLike",a.isDateLike,a.compareDateLike);a.registerComparator("arrayLike",a.isArrayLike,a.compareArrayLike);a.reprRegistry=new a.AdapterRegistry();a.registerRepr("arrayLike",a.isArrayLike,a.reprArrayLike);a.registerRepr("string",a.typeMatcher("string"),a.reprString);a.registerRepr("numbers",a.typeMatcher("number","boolean"),a.reprNumber);a.jsonRegistry=new a.AdapterRegistry();var b=a.concat(a.EXPORT,a.EXPORT_OK);a.EXPORT_TAGS={":common":a.concat(a.EXPORT_OK),":all":b};a.nameFunctions(this)};MochiKit.Base.__new__();if(MochiKit.__export__){compare=MochiKit.Base.compare}MochiKit.Base._exportSymbols(this,MochiKit.Base);