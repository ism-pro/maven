if(typeof(bobj.crv.ReportAlbum)=="undefined"){bobj.crv.ReportAlbum={}}if(typeof(bobj.crv.Tab)=="undefined"){bobj.crv.Tab={}}if(typeof(bobj.crv.TabBar)=="undefined"){bobj.crv.TabBar={}}if(typeof(bobj.crv.ButtonList)=="undefined"){bobj.crv.ButtonList={}}bobj.crv.newReportAlbum=function(c){var f=MochiKit.Base;var e=f.update;var b=f.bind;var a=bobj.crv.ReportAlbum;c=e({id:bobj.uniqueId(),initTabIdx:0,width:800,height:500,displayDrilldownTab:true},c);var d=newTabbedZone(c.id,null,c.width,c.height);d.tabs=bobj.crv.newTabBar({displayDrilldownTab:c.displayDrilldownTab});d.tabs.removeCB=b(a._onCloseTab,d);d.tabs.selectCB=b(a._onSelectTab,d);bobj.fillIn(d,c);d.widgetType="ReportAlbum";d._children=[];d._curView=null;d._curSigs=[];d.selectOld=d.select;e(d,a);return d};bobj.crv.ReportAlbum.init=function(){var b=MochiKit.Signal.connect;var c=MochiKit.Signal.signal;var a=MochiKit.Base.partial;this.tzOldInit();this.tabs.init();if(this._children.length){if(this.initTabIdx<0||this.initTabIdx>=this._children.length){this.initTabIdx=0}this.select(this.initTabIdx);b(this._curView,"grpDrilldown",a(c,this,"grpDrilldown"));b(this._curView,"grpNodeRetrieveChildren",a(c,this,"grpNodeRetrieveChildren"));b(this._curView,"grpNodeCollapse",a(c,this,"grpNodeCollapse"));b(this._curView,"grpNodeExpand",a(c,this,"grpNodeExpand"));b(this._curView,"paramAdvanced",a(c,this,"paramAdvanced"));b(this._curView,"paramApply",a(c,this,"paramApply"))}};bobj.crv.ReportAlbum.update=function(c,a){if(c&&c.cons=="bobj.crv.newReportAlbum"&&this.getSelectedView()){var b=c.children[c.args.initTabIdx];if(b){if(b.args.viewStateId==this.getSelectedView().viewStateId){this.getSelectedView().update(b,a)}}}};bobj.crv.ReportAlbum.addChild=function(a){if(a){this._children.push(a);this.add(a.label,a.tooltip)}};bobj.crv.ReportAlbum.getHTML=function(){var d=this.beginHTML();var c=this._children;for(var b=0,a=c.length;b<a;++b){d+=this.beginTabHTML(b);d+=c[b].getHTML();d+=this.endTabHTML()}d+=this.endHTML();return d+bobj.crv.getInitHTML(this.widx)};bobj.crv.ReportAlbum.resizeOuter=function(a,c){var b=bobj.isNumber;if(b(a)){a=Math.max(0,a-10)}if(b(c)){c=Math.max(0,c-33)}this.resize(a,c);this.tabs.resize(a);if(this._curView){this._curView.resize()}};bobj.crv.ReportAlbum.getBestFitSize=function(){var a=10;var b=33;if(this._curView){var c=this._curView.getBestFitSize();a+=c.width;b+=c.height}return{width:a,height:b}};bobj.crv.ReportAlbum.beginTabHTML=function(a){return bobj.html.openTag("div",{id:"tzone_tab_"+a+"_"+this.id,style:{display:"none",width:this.w+"px",height:this.h+"px",position:"relative"}})};bobj.crv.ReportAlbum.getSelectedView=function(){return this._curView};bobj.crv.ReportAlbum.isToolPanelDisplayed=function(){return this._curView&&this._curView.toolPanel&&this._curView.toolPanel.isDisplayed()};bobj.crv.ReportAlbum.setDisplayToolPanel=function(a){if(this._curView){this._curView.setDisplayToolPanel(a)}};bobj.crv.ReportAlbum.select=function(c){var b=MochiKit.Signal;var d=b.disconnect;var g=b.connect;var f=b.signal;if(c>=0&&c<this._children.length){var e=this._curSigs;while(e.length){d(e.pop())}this._curView=this._children[c];var a=this;e.push(g(this._curView,"hideToolPanel",function(){f(a,"hideToolPanel")}));e.push(g(this._curView,"resizeToolPanel",function(h){f(a,"resizeToolPanel",h)}));this.selectOld(c)}};bobj.crv.ReportAlbum.remove=function(a){var c=this.zoneLayers[a];if(c&&c.parentNode){c.parentNode.removeChild(c)}arrayRemove(this,"zoneLayers",a);arrayRemove(this,"_children",a);var b=this.tabs.getSelection();if(b>=0){this.select(b)}};bobj.crv.ReportAlbum._onCloseTab=function(c,b){var d=MochiKit.Signal.signal;var a=this._children[b];this.remove(b);d(this,"removeView",a);d(this,"selectView",this._curView)};bobj.crv.ReportAlbum._onSelectTab=function(b,a){this.select(a);MochiKit.Signal.signal(this,"selectView",this._curView)};bobj.crv.newTab=function(a){var c=MochiKit.Base.update;a=c({id:bobj.uniqueId(),hasCloseBtn:true,closeCB:null,tabWidth:50},a);a.isTop=true;var b=newTabWidget(a.id,a.isTop,a.label,a.clickCB,a.value,a.icon,a.iconW,a.iconH,a.iconOffX,a.iconOffY,a.dblClickCB,a.alt);b._crvTabOldInit=b.init;b._closeBtn=null;bobj.fillIn(b,a);c(b,bobj.crv.Tab);return b};bobj.crv.Tab._imageOffsets={closeBtn:{normal:{x:0,y:18,w:18,h:18},mouseOver:{x:0,y:0,w:18,h:18}},tab:{top:{selected:{left:{x:0,y:0,w:15,h:24},middle:{x:0,y:24},right:{normal:{x:0,y:48,w:15,h:24},narrow:{x:10,y:48,w:5,h:24}}},unselected:{left:{x:0,y:72,w:15,h:24},middle:{x:0,y:96},right:{normal:{x:0,y:120,w:15,h:24},narrow:{x:10,y:120,w:5,h:24}}}}}};bobj.crv.Tab.init=function(){var c=MochiKit.Base.bind;var a=bobj.crv.Tab;this._crvTabOldInit();var b=getLayer("tabWidgetCloseBtn_"+this.id);if(b){b.onmouseover=c(a._onCloseBtnMouseOver,this);b.onmouseout=c(a._onCloseBtnMouseOut,this);b.parentNode.onclick=c(a._onCloseBtnClick,this)}this._closeBtn=b};bobj.crv.Tab._onCloseBtnMouseOver=function(){var a=this._imageOffsets.closeBtn.mouseOver;changeOffset(this._closeBtn,a.x,a.y)};bobj.crv.Tab._onCloseBtnMouseOut=function(){var a=this._imageOffsets.closeBtn.normal;changeOffset(this._closeBtn,a.x,a.y)};bobj.crv.Tab._onCloseBtnClick=function(){if(this.closeCB){this.closeCB()}};bobj.crv.Tab.getHTML=function(){var n=this;var i=MochiKit.Base.update;var s=bobj.html;var w=this._imageOffsets;var c="thumbtxt"+(n.isSelected?"sel":"");var m=_codeWinName+".TabWidget_clickCB('"+n.id+"');return false";var p=_codeWinName+".TabWidget_dblclickCB('"+n.id+"');return false";var l=_codeWinName+".TabWidget_keyDownCB('"+n.id+"',event);";var b=_codeWinName+".TabWidget_contextMenuCB('"+n.id+"',event);return false";var u=n.icon?n.icon:_skin+"../transp.gif";var d=n.icon?3:0;var v=w.tab[this.isTop?"top":"bottom"];v=v[this.selected?"selected":"unselected"];var g=v.left;var e=v.right[this.hasCloseBtn?"narrow":"normal"];var k=v.middle;var f=w.closeBtn.normal;var t={onmouseover:"return true;",onclick:m,id:this.id,ondblclick:p,onkeydown:l,oncontextmenu:b,style:{cursor:_hand},cellspacing:"0",cellpadding:"0",border:"0"};var r={"background-image":"url('"+_skin+"tabs.gif')","background-position":(-k.x)+"px "+(-k.y)+"px"};if(this.isTop){r["padding-top"]="1px"}else{r["padding-bottom"]="3px"}var a=i({"padding-right:":d+"px",width:(this.iconW+d),align:"left"},r);if(this.isTop){a["padding-top"]="1px"}else{a["padding-bottom"]="2px"}var q=i({display:this.hasCloseBtn?"":"none"},r);var j=s.TABLE(t,s.TBODY(null,s.TR({valign:"middle",height:g.h},s.TD({width:g.w},imgOffset(_skin+"tabs.gif",g.w,g.h,g.x,g.y,"tabWidgetLeft_"+n.id)),s.TD({id:"tabWidgetImg_"+n.id,style:a},imgOffset(u,n.iconW,n.iconH,n.iconOffX,n.iconOffY,"tabWidgetIcon_"+n.id,null,n.iconAlt)),s.TD({width:n.tabWidth,id:"tabWidgetMid_"+this.id,style:r},s.SPAN({style:{"white-space":"nowrap"}},lnk(convStr(n.name,true),null,c,"tabWidgetLnk_"+n.id))),s.TD({width:f.w,id:"tabWidgetClose_"+n.id,style:q},s.A({href:"javascript:void(0)",title:L_bobj_crv_Close},imgOffset(_skin+"dialogelements.gif",f.w,f.h,f.x,f.y,"tabWidgetCloseBtn_"+n.id))),s.TD({width:e.w},imgOffset(_skin+"tabs.gif",e.w,e.h,e.x,e.y,"tabWidgetRight_"+n.id)))));return j};bobj.crv.Tab.changeContent=function(e){var b=this;if(!b.lnkLayer){b.lnkLayer=getLayer("tabWidgetLnk_"+b.id);b.leftImgLayer=getLayer("tabWidgetLeft_"+b.id);b.rightImgLayer=getLayer("tabWidgetRight_"+b.id);b.midImgLayer=getLayer("tabWidgetMid_"+b.id);b.imgImgLayer=getLayer("tabWidgetImg_"+b.id);b.closeImgLayer=getLayer("tabWidgetClose_"+b.id);b.iconLayer=getLayer("tabWidgetIcon_"+b.id)}if(!e){b.lnkLayer.innerHTML=convStr(b.name,true);var j=b.iconLayer;changeOffset(j,b.iconOffX,b.iconOffY,b.icon?b.icon:_skin+"../transp.gif");j.alt=b.iconAlt;j.style.width=""+b.iconW+"px";j.style.height=""+b.iconH+"px";var g=b.icon?3:0;var c=b.imgImgLayer;c.style.paddingRight=""+g+"px";c.style.width=""+(g+((b.icon&&bobj.isNumber(b.iconW))?b.iconW:0))+"px";if(_moz&&!_saf){c.width=(g+((b.icon&&bobj.isNumber(b.iconW))?b.iconW:0))}}var d=this._imageOffsets;var i=d.tab[this.isTop?"top":"bottom"];i=i[this.isSelected?"selected":"unselected"];var a=i.left;var f=i.right[this.hasCloseBtn?"narrow":"normal"];var h=i.middle;changeOffset(b.leftImgLayer,a.x,a.y);changeOffset(b.midImgLayer,h.x,h.y);changeOffset(b.closeImgLayer,h.x,h.y);changeOffset(b.imgImgLayer,h.x,h.y);changeOffset(b.rightImgLayer,f.x,f.y);b.lnkLayer.className="thumbtxt"+(b.isSelected?"sel":"")};bobj.crv.newTabBar=function(a){var c=MochiKit.Base.update;a=c({id:bobj.uniqueId(),removeCB:null,selectCB:null,displayDrilldownTab:true},a);a.isTop=true;var b=newWidget(a.id);bobj.fillIn(b,a);b.widgetType="TabBar";b._tabs=[];b._tabRowLayer=null;b._tabBarLayer=null;b._selIndex=0;b._tabBarOldInit=b.init;b._tabBarOldResize=b.resize;b._selTabXOffset=0;b._menuBtnWidth=24;var d=MochiKit.Base.bind;b._tabMenuBtn=bobj.crv.newButtonList({id:b.id+"_sel",buttonWidth:b._menuBtnWidth,changeCB:d(bobj.crv.TabBar._onMenuChange,b)});c(b,bobj.crv.TabBar);return b};bobj.crv.TabBar.init=function(){this._tabBarOldInit();if(this._tabMenuBtn){this._tabMenuBtn.init()}if(this.displayDrilldownTab===false){this.hide()}this._tabRowLayer=getLayer(this.id+"_tabRow");this._tabBarLayer=getLayer(this.id+"_tabBar");this._tabCtnLayer=this._tabBarLayer.parentNode;this._tabSelLayer=getLayer(this.id+"_tabSel");for(var a=0;a<this._tabs.length;++a){var b=this._tabs[a];b.init();b.select(a==this._selIndex)}setTimeout(MochiKit.Base.bind(this._setMenuVis,this),0)};bobj.crv.TabBar.add=function(h,j,k,f,a,i,e,d,c,g){var b={label:h,value:j,idx:k,icon:f,iconW:a,iconH:i,iconOffX:e,iconOffY:d,alt:c,isTop:this.isTop};if(bobj.isBoolean(g)){b.hasCloseBtn=g}else{b.hasCloseBtn=(this._tabs.length?true:false)}return this.kwAdd(b)};bobj.crv.TabBar.kwAdd=function(a){var c=MochiKit.Base.bind;a.id=bobj.uniqueId();var b=bobj.crv.newTab(a);b.cb=c(this._onTabClick,this,b);b.closeCB=c(this._onTabCloseBtnClick,this,b);this._tabs.push(b);this._tabMenuBtn.add(a.label);return b};bobj.crv.TabBar.remove=function(e){var g=this;var d=g._tabs;var b=d.length;var a=bobj.isNumber(e)?e:this.getIndex(e);if(a>=0&&a<b){var f=d[a];var c=f.layer;arrayRemove(g,"_tabs",a);g._tabMenuBtn.getMenu().del(a);d=g._tabs;b=d.length;if(c){c.parentNode.style.display="none"}g._setMenuVis();if(g._selIndex>a){g.select(g._selIndex-1)}else{if(g._selIndex==a&&b>0){g.select(Math.min(a,b-1))}else{g.select(g._selIndex)}}}};bobj.crv.TabBar.hide=function(){try{var b=this.layer.parentNode;var a=b.parentNode;a.style.display="none"}catch(c){if(bobj.crv.config.isDebug){throw c}}};bobj.crv.TabBar.getIndex=function(a){return MochiKit.Base.findIdentical(this._tabs,a)};bobj.crv.TabBar.getSelection=function(){return this._selIndex};bobj.crv.TabBar.getCount=function(){return this._tabs.length};bobj.crv.TabBar.getTabAt=function(a){return this._tabs[a]};bobj.crv.TabBar.select=function(c){if(!bobj.isNumber(c)){c=this.getIndex(c)}if(bobj.isNumber(c)){var b=c;var a=this._tabs.length;if(b==-1){if(this._selIndex>=0&&this._selIndex<a){return}b=0}if(b>=0&&b<a){if(this._selIndex>=0&&this._selIndex!=b&&this._selIndex<a){this._tabs[this._selIndex].select(false)}this._selIndex=b;this._tabs[b].select(true);if(this._tabMenuBtn){this._tabMenuBtn.getMenu().select(b)}this.scroll(null,this._selIndex)}}};bobj.crv.TabBar.resize=function(a,b){this._tabBarOldResize(a,b);if(bobj.isNumber(a)&&this._tabBarLayer){this._tabCtnLayer.style.width=Math.max(0,a)+"px";this._setMenuVis();this.scroll(this._selIndex)}};bobj.crv.TabBar._setMenuVis=function(){var b=this._tabBarLayer;var a=this._tabCtnLayer;var c=this._tabSelLayer;if(b&&a&&c){if(a.offsetWidth<b.offsetWidth){c.style.display=""}else{c.style.display="none"}}};bobj.crv.TabBar.scroll=function(c,i){if(!this._tabBarLayer){return}i=bobj.isNumber(i)?i:-1;if(bobj.isString(c)){if(c=="first"){i=0}else{if(c=="previous"){i=this._selIndex-1}else{if(c=="next"){i=this._selIndex+1}else{if(c=="last"){i=this.getCount()-1}}}}}else{if(bobj.isNumber(c)){i=c}else{if(c){i=this.getIndex(c)}}}if(i>=0&&i<this.getCount()){var g=this._tabBarLayer;var d=g.parentNode;var k=g.style;var b=parseInt(k.left,10)||0;var e=b+g.offsetWidth;var j=this._getItemXPos(i)+b;var f=j+this.getTabAt(i).getWidth();var a=d.offsetWidth-this._tabMenuBtn.getWidth();var h=0;if(j<0){h=(-1*j)}else{if(f>a){h=-(f-a)}else{if(e<a&&b<0){h=Math.min(a-e,-b)}}}if(h){k.left=(b+h)+"px"}}};bobj.crv.TabBar.getHTML=function(){var e=bobj.html;var j=24;var b={height:j+"px",overflow:"hidden",width:"100%",position:"relative"};var d={position:"relative"};var g={width:this._menuBtnWidth+"px",height:j+"px",display:"none",position:"absolute",top:"0px",right:"0px","padding-top":"3px"};var a="";for(var c=0;c<this._tabs.length;++c){a+=e.TD(null,this._tabs[c].getHTML())}var f=e.DIV({id:this.id,style:b},e.TABLE({cellspacing:"0",cellpadding:"0",border:"0",style:{width:"100%"}},e.TBODY(null,e.TR({valign:"bottom",height:j},e.TD(null,e.DIV({style:{overflow:"hidden",position:"relative"}},e.TABLE({id:this.id+"_tabBar",style:d,cellspacing:"0",cellpadding:"0",border:"0"},e.TBODY(null,e.TR({id:this.id+"_tabRow"},a)))))))),e.DIV({id:this.id+"_tabSel","class":"panelzone",style:g},this._tabMenuBtn.getHTML()));return f};bobj.crv.TabBar._onTabClick=function(b){var a=this.getIndex(b);if(a<0){return}this.select(a);if(this.selectCB){this.selectCB(b,a)}};bobj.crv.TabBar._onTabCloseBtnClick=function(b){var a=this.getIndex(b);this.remove(a);if(this.removeCB){this.removeCB(b,a)}};bobj.crv.TabBar._onMenuChange=function(){var b=this._tabMenuBtn.getMenu();if(b){var a=b.getSelection();if(a){this.select(a.index);if(this.selectCB){this.selectCB(this.getTabAt(a.index),a.index)}}}};bobj.crv.TabBar._getItemXPos=function(b){var a=0;for(var c=0;c<b;c++){a+=parseInt(this._tabs[c].getWidth(),10)}return a};bobj.crv.newButtonList=function(a){a=MochiKit.Base.update({id:bobj.uniqueId(),numLines:null,buttonWidth:24,buttonTooltip:L_bobj_crv_TabList,changeCB:null,label:null,tabIndex:0,multiSelect:false,menuWidth:null,menuTooltip:null},a);var b=newButtonWidget(a.id,a.label,bobj.crv.ButtonList._onClick,a.buttonWidth,null,a.buttonTooltip,a.tabIndex,0,_skin+"menus.gif",7,16,0,81,true,0,97);b._menu=newListWidget(a.id+"_menu",MochiKit.Base.bind(bobj.crv.ButtonList._onChange,b),a.multiSelect,a.menuWidth,a.numLines||2,a.menuTooltip,null,null);b._listItems=[];b._blOldInit=b.init;b._blOldGetHTML=b.getHTML;b._menuDiv=null;b._captureClicks=MenuWidget_captureClicks;b._releaseClicks=MenuWidget_releaseClicks;bobj.fillIn(b,a);b.widgetType="ButtonList";MochiKit.Base.update(b,bobj.crv.ButtonList);return b};bobj.crv.ButtonList.getMenu=function(){return this._menu};bobj.crv.ButtonList.add=function(b,c,a,d){if(this._menu&&this._menu.layer){this._menu.add(b,c,a,d)}else{this._listItems.push({lbl:b,val:c,sel:a,id:d})}};bobj.crv.ButtonList.init=function(){var e=this._menu;this._blOldInit();e.init();this._menuDiv=getLayer(this.id+"_menuDiv");var d=this._listItems;for(var b=0,a=d.length;b<a;++b){var c=d[b];e.add(c.lbl,c.val,c.sel,c.id)}this._listItems=[]};bobj.crv.ButtonList.getHTML=function(){var a=bobj.html;var b={id:this.id+"_menuDiv",onmousedown:"event.cancelBubble=true","class":"menuFrame",style:{visibility:"hidden",position:"absolute","z-index":5000}};return this._blOldGetHTML()+a.DIV(b,this._menu.getHTML())};bobj.crv.ButtonList.isMenuShowing=function(){return this._menuDiv&&this._menuDiv.style.visibility!="hidden"};bobj.crv.ButtonList.hideMenu=function(){if(this._menuDiv){this._menuDiv.style.visibility="hidden"}};bobj.crv.ButtonList.showMenu=function(){if(this._menuDiv){this._captureClicks();var i=document.body;if(this._menuDiv.parentNode!==i){i.appendChild(this._menuDiv)}var b=this._menuDiv.style;b.left="-1000px";b.top="-1000px";b.visibility="visible";var c=MochiKit.Style.getViewportDimensions();var m=this._menu.layer.offsetWidth;var g=this._menu.getHeight();if(!this.numLines){g=Math.min(this._menu.layer.scrollHeight+10,c.h-10);this._menu.resize(null,g)}var a=getPosScrolled(this.layer);var l=a.x;var k=a.y+this.getHeight();var e=l+m+4;var j=k+g+4;var f=c.w+i.scrollLeft-Math.max(0,(c.w-i.offsetWidth));if(e>f){l=Math.max(0,l-(e-f))}var d=c.h+i.scrollTop;if(j>d){k=Math.max(0,k-(j-d))}b.left=l+"px";b.top=k+"px"}};bobj.crv.ButtonList._captureClicks=function(){var b=MochiKit.Base.bind;try{this.layer.onmousedown=b(this._onCaptureClick,this,true);this._oldMousedown=document.onmousedown;document.onmousedown=b(this._onCaptureClick,this,false)}catch(a){if(bobj.crv.config.isDebug){throw a}}};bobj.crv.ButtonList._releaseClicks=function(){if(this.layer.onmousedown){this.layer.onmousedown=null;document.onmousedown=this._oldMousedown}};bobj.crv.ButtonList._onClick=function(){if(!this._cancelNextClick){this.showMenu()}this._cancelNextClick=false};bobj.crv.ButtonList._onChange=function(){this._releaseClicks();this.hideMenu();if(this.changeCB){this.changeCB()}};bobj.crv.ButtonList._onCaptureClick=function(a,b){this._cancelNextClick=a;eventCancelBubble(b);this.hideMenu();this._releaseClicks()};