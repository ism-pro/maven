if(typeof bobj.crv.params.ParameterPanel=="undefined"){bobj.crv.params.ParameterPanel={};bobj.crv.params.ParameterPanelToolbar={};bobj.crv.params.ParameterTab={};bobj.crv.params.ParameterDialog={}}bobj.crv.params.newParameterPanel=function(a){a=MochiKit.Base.update({id:bobj.uniqueId()+"_IPPanel"},a);var b=newWidget(a.id);b.widgetType="ParameterPanel";bobj.fillIn(b,a);MochiKit.Base.update(b,bobj.crv.params.ParameterPanel);b._tabPanel=bobj.crv.newStackedPanel({id:b.id+"_ParamtersStack"});b._selected=null;b._toolbar=bobj.crv.params.newParameterPanelToolbar({id:b.id+"_IPToolbar"});return b};bobj.crv.params.ParameterPanel.setToolbarCallBacks=function(a,b){if(this._toolbar){this._toolbar.delClickCB=a;this._toolbar.applyClickCB=b}};bobj.crv.params.ParameterPanel.init=function(){Widget_init.call(this);this._toolbar.init();if(this._tabPanel){this._tabPanel.init()}};bobj.crv.params.ParameterPanel.getHTML=function(){var b=bobj.html.DIV;var a=this._getCommonLayerStyle();a.overflow="hidden";var c=this._toolbar.getHTML();if(this._tabPanel){c+=this._tabPanel.getHTML()}return b({id:this.id,style:a},c)};bobj.crv.params.ParameterPanel._getErrorMsgContent=function(b){var c=bobj.html.DIV;var a=this._getCommonLayerStyle();return c({id:this.id,style:a},b)};bobj.crv.params.ParameterPanel._getCommonLayerStyle=function(){var a={};if(this.height){a.height=bobj.unitValue(this.height)}if(this.width){a.width=bobj.unitValue(this.width)}return a};bobj.crv.params.ParameterPanel.showError=function(a){if(a){this.setHTML(this._getErrorMsgContent(a))}};bobj.crv.params.ParameterPanel.resize=function(a,b){Widget_resize.call(this,a,b);if(this._toolbar){a=this.layer.clientWidth;this._toolbar.resize(a);if(this._tabPanel){b=this.layer.clientHeight-this._toolbar.getHeight();this._tabPanel.resize(a,b)}}};bobj.crv.params.ParameterPanel.addParameter=function(b){b=MochiKit.Base.update({paramUI:null,label:null,isDataFetching:false,isDirty:false,isReadOnly:false,selectCB:null,openAdvCB:null,minMaxTooltip:null,id:this._tabPanel.id+"_P"+(this._tabPanel.getNumTabs()+1)},b);if(b.paramUI){var a=bobj.crv.params.newParameterTab(b);a.setContent(b.paramUI);this._tabPanel.addTab(a)}};bobj.crv.params.ParameterPanel.removeParameter=function(a){this._tabPanel.removeTab(a)};bobj.crv.params.ParameterPanel.getWidth=function(){if(this.layer){return this.layer.offsetWidth}return this.width};bobj.crv.params.ParameterPanel.setDeleteButtonEnabled=function(a){this._toolbar.delButton.setDisabled(!a)};bobj.crv.params.ParameterPanel.setApplyButtonEnabled=function(a){this._toolbar.applyButton.setDisabled(!a)};bobj.crv.params.ParameterPanel.getIndex=function(d){var c=this._tabPanel.getNumTabs();for(var a=0;a<c;++a){var b=this._tabPanel.getTab(a);if(b.getContent()===d){return a}}return -1};bobj.crv.params.ParameterPanel.getParameter=function(a){var b=this._tabPanel.getTab(a);if(b){return b.getContent()}return null};bobj.crv.params.ParameterPanel.setDirty=function(a,c){var b=this._tabPanel.getTab(a);if(b){b.setDirty(c);b.getContent().setBgColor()}};bobj.crv.params.ParameterPanel.isDirty=function(a){var b=this._tabPanel.getTab(a);if(b){return b.isDirty()}return false};bobj.crv.params.ParameterPanel.setSelected=function(b,a){var c=this._tabPanel.getTab(b);if(c){if(this._selected){this._selected.setSelected(false)}c.setSelected(a);this._selected=c}};bobj.crv.params.ParameterPanel.expand=function(a){var b=this._tabPanel.getTab(a);if(b){b.expand()}};bobj.crv.paramPanelIcon=bobj.crvUri("images/param_panel.gif");bobj.crv.paramDataFetchingIconYOffset=32;bobj.crv.paramDirtyIconYOffset=48;bobj.crv.paramInfoIconYOffset=64;bobj.crv.paramsApplyIconYOffset=80;bobj.crv.paramsDeleteIconYOffset=102;bobj.crv.params.newParameterPanelToolbar=function(a){a=MochiKit.Base.update({id:bobj.uniqueId()},a);var b=newPaletteContainerWidget(a.id);bobj.fillIn(b,a);b.widgetType="ParameterPanelToolbar";b._paletteContainerInit=b.init;MochiKit.Base.update(b,bobj.crv.params.ParameterPanelToolbar);b._palette=newPaletteWidget(b.id+"_palette");b.add(b._palette);var c=MochiKit.Base.bind;b.delButton=newIconWidget(b.id+"_delBtn",bobj.crv.paramPanelIcon,c(b._onDelClick,b),L_bobj_crv_ParamsDelete,L_bobj_crv_ParamsDeleteTooltip,16,16,3,3+bobj.crv.paramsDeleteIconYOffset,25,3+bobj.crv.paramsDeleteIconYOffset);b.applyButton=newIconWidget(b.id+"_applyBtn",bobj.crv.paramPanelIcon,c(b._onApplyClick,b),L_bobj_crv_ParamsApply,L_bobj_crv_ParamsApplyTip,16,16,3,3+bobj.crv.paramsApplyIconYOffset,25,3+bobj.crv.paramsApplyIconYOffset);b._palette.add(b.applyButton);b._palette.add();b._palette.add(b.delButton);return b};bobj.crv.params.ParameterPanelToolbar.init=function(){this._paletteContainerInit();this._palette.init();this.delButton.setDisabled(true);this.applyButton.setDisabled(true)};bobj.crv.params.ParameterPanelToolbar.beginHTML=function(){return bobj.html.openTag("div",{id:this.id,"class":"dialogzone",style:{overflow:"hidden",margin:"0"}})};bobj.crv.params.ParameterPanelToolbar.getHTML=function(){return(this.beginHTML()+this._palette.getHTML()+this.endHTML())};bobj.crv.params.ParameterPanelToolbar._onDelClick=function(){if(this.delClickCB){bobj.crv.logger.info("UIAction ParameterPanel.Delete");this.delClickCB()}};bobj.crv.params.ParameterPanelToolbar._onApplyClick=function(){if(this.applyClickCB){bobj.crv.logger.info("UIAction ParameterPanel.Apply");this.applyClickCB()}};bobj.crv.params.newParameterTab=function(a){a=MochiKit.Base.update({label:null,isDataFetching:false,isDirty:false,isReadOnly:false,minMaxTooltip:null,openAdvCB:null,selectCB:null,id:null},a);a.iconPos="right";a.expandImgPos="right";var c=bobj.crv.newStackedTab(a);bobj.fillIn(c,a);c._isDirtyInit=a.isDirty;MochiKit.Base.update(c,bobj.crv.params.ParameterTab);c._dirtyId=c.id+"_dirty";c.addIcon(bobj.crv.paramPanelIcon,0,bobj.crv.paramDirtyIconYOffset,L_bobj_crv_ParamsDirtyTip,false,c._isDirtyInit,c._dirtyId);if(a.minMaxTooltip||a.isReadOnly){var b="";if(a.isReadOnly&&a.minMaxTooltip){b=L_bobj_crv_ParamsReadOnly+"<BR>"+a.minMaxTooltip}else{if(a.minMaxTooltip){b=a.minMaxTooltip}else{if(a.isReadOnly){b=L_bobj_crv_ParamsReadOnly}}}c.addIcon(bobj.crv.paramPanelIcon,0,bobj.crv.paramInfoIconYOffset,b,false,true,c.id+"_icnInfo")}if(c.isDataFetching){c.addIcon(bobj.crv.paramPanelIcon,0,bobj.crv.paramDataFetchingIconYOffset,L_bobj_crv_ParamsDataTip,true,true,null)}return c};bobj.crv.params.ParameterTab.setDirty=function(a){if(a){this.showIcon.call(this,this._dirtyId)}else{this.hideIcon.call(this,this._dirtyId)}};bobj.crv.params.ParameterTab.isDirty=function(){if(this.layer){return this.isIconShowing(this._dirtyId)}else{return this._isDirtyInit}};bobj.crv.params.ParameterTab.isSelected=function(){return MochiKit.DOM.hasElementClass(this._labelCtn,"iactParamLabelSel")};bobj.crv.params.ParameterTab.setSelected=function(a){if(a){MochiKit.DOM.addElementClass(this._labelCtn,"iactParamLabelSel")}else{MochiKit.DOM.removeElementClass(this._labelCtn,"iactParamLabelSel")}};bobj.crv.params.newParameterDialog=function(a){a=MochiKit.Base.update({id:bobj.uniqueId(),prompt:null,promptHTML:"",showCB:null,hideCB:null},a);var b=newDialogBoxWidget(a.id,L_bobj_crv_ParamsDlgTitle,a.width,a.height);bobj.fillIn(b,a);b._showDialogBox=b.show;b._initDialogBox=b.init;MochiKit.Base.update(b,bobj.crv.params.ParameterDialog);return b};bobj.crv.params.ParameterDialog.init=function(){this._initDialogBox();this._form=document.getElementById(this.id+"_form")};bobj.crv.params.ParameterDialog._checkInitialization=function(){if(!this.layer){targetApp(this.getHTML());this.init()}};bobj.crv.params.ParameterDialog.show=function(a){if(a){this._checkInitialization();this.setResize(MochiKit.Base.noop);this._showDialogBox(true)}else{if(this.layer){this._showDialogBox(false)}}if(a&&this.showCB){this.showCB()}else{if(!a&&this.hideCB){this.hideCB()}}};bobj.crv.params.ParameterDialog.isVisible=function(){return(this.initialized()&&this.isDisplayed())};bobj.crv.params.ParameterDialog.setPromptHTML=function(e){if(e){this._checkInitialization();if(this.isDisplayed()){this._showDialogBox(false)}this._deleteScripts();var b=bobj.html.extractHtml(e);this.promptHTML=b.html;if(this._form){this._form.innerHTML='<div style="overflow:auto">'+this.promptHTML+"</div>"}var k=b.links;for(var j=0,f=k.length;j<f;++j){bobj.includeLink(k[j])}var g={x:getScrollX(),y:getScrollY()};var c=b.scripts;for(var a=0,d=c.length;a<d;++a){var i=c[a];if(!i){continue}if(i.text){bobj.evalInWindow(i.text)}}var h={x:getScrollX(),y:getScrollY()};if(g.x!=h.x||g.y!=h.y){_curWin.scrollTo(g.x,g.y)}}};bobj.crv.params.ParameterDialog._deleteScripts=function(){var b=this._form;if(b&&b.ContextHandleID){var c=b.ContextHandleID.value;for(var a in window){if(a.indexOf(c)===0){delete window[a]}}}};bobj.crv.params.ParameterDialog.getHTML=function(c){var a=bobj.html.FORM;var b="eventCancelBubble(event);return false;";return this.beginHTML()+a({id:this.id+"_form",onsubmit:b},this.promptHTML)+this.endHTML()};