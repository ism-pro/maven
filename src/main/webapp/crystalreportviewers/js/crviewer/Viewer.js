if(typeof(bobj.crv.Viewer)=="undefined"){bobj.crv.Viewer={}}bobj.crv.Viewer.LayoutTypes={FIXED:"fixed",CLIENT:"client",FITREPORT:"fitreport"};bobj.crv.Viewer.PromptingTypes={HTML:"html",FLEX:"flex"};bobj.crv.newViewer=function(a){a=MochiKit.Base.update({id:bobj.uniqueId(),promptingType:bobj.crv.Viewer.LayoutTypes.HTML,layoutType:bobj.crv.Viewer.LayoutTypes.FIXED,visualStyle:{className:null,backgroundColor:null,borderWidth:null,borderStyle:null,borderColor:null,fontFamily:null,fontWeight:null,textDecoration:null,color:null,width:"800px",height:"600px",fontStyle:null,fontSize:null,top:"0px",left:"0px"}},a);var b=newWidget(a.id);bobj.fillIn(b,a);b.widgetType="Viewer";b._topToolbar=null;b._botToolbar=null;b._reportAlbum=null;b._separator=null;b._print=null;b._export=null;b._promptDlg=null;b._reportProcessing=null;b._eventListeners=[];b.initOld=b.init;b.boundaryControl=new bobj.crv.BoundaryControl(a.id+"_bc");MochiKit.Base.update(b,bobj.crv.Viewer);return b};bobj.crv.Viewer.addChild=function(a){if(a.widgetType=="ReportAlbum"){this._reportAlbum=a}else{if(a.widgetType=="Toolbar"){if(a.layoutAlign=="bottom"){this._botToolbar=a}else{this._topToolbar=a;this._separator=bobj.crv.newSeparator()}}else{if(a.widgetType=="PrintUI"){this._print=a}else{if(a.widgetType=="ExportUI"){this._export=a}else{if(a.widgetType=="ReportProcessingUI"){this._reportProcessing=a}}}}}};bobj.crv.Viewer.removeFlashActivations=function(){if(_ie&&this.layer&&this.layer.getElementsByTagName){var d=this.layer.getElementsByTagName("object");for(var a=0;a<d.length;a++){var c=d[a];var f=c.cloneNode(true);var e=c.parentNode;var b=c.nextSibling;if(e&&f){e.removeChild(c);e.insertBefore(f,b);f.outerHTML=f.outerHTML}}}};bobj.crv.Viewer.getHTML=function(){var b=bobj.html;var c={overflow:"hidden",position:"relative",left:this.visualStyle.left,top:this.visualStyle.top};var a=b.DIV({dir:"ltr",id:this.id,style:c,"class":"dialogzone"},this._topToolbar?this._topToolbar.getHTML():"",this._separator?this._separator.getHTML():"",this._reportAlbum?this._reportAlbum.getHTML():"",this._botToolbar?this._botToolbar.getHTML():"");return a+bobj.crv.getInitHTML(this.widx)};bobj.crv.Viewer._onWindowResize=function(){if(this._currWinSize.w!=winWidth()||this._currWinSize.h!=winHeight()){this._doLayout();this._currWinSize.w=winWidth();this._currWinSize.h=winHeight()}};bobj.crv.Viewer.init=function(){this.initOld();bobj.setVisualStyle(this.layer,this.visualStyle);this._currWinSize={w:winWidth(),h:winHeight()};var c=MochiKit.Signal.connect;var d=MochiKit.Signal.signal;var b=MochiKit.Base.partial;if(this.layoutType.toLowerCase()==bobj.crv.Viewer.LayoutTypes.CLIENT){c(window,"onresize",this,"_onWindowResize")}if(this.layer&&_ie&&bobj.checkParent(this.layer,"TABLE")){c(window,"onload",this,"_doLayoutOnLoad");this._oldCssVisibility=this.css.visibility;this.css.visibility="hidden"}else{this._doLayout()}if(this._topToolbar){c(this._topToolbar,"showGroupTree",this,"_onShowGroupTreeClick");c(this._topToolbar,"showParamPanel",this,"_onShowParamPanelClick");c(this._topToolbar,"zoom",b(d,this,"zoom"));c(this._topToolbar,"drillUp",b(d,this,"drillUp"));c(this._topToolbar,"firstPage",b(d,this,"firstPage"));c(this._topToolbar,"prevPage",b(d,this,"prevPage"));c(this._topToolbar,"nextPage",b(d,this,"nextPage"));c(this._topToolbar,"lastPage",b(d,this,"lastPage"));c(this._topToolbar,"selectPage",b(d,this,"selectPage"));c(this._topToolbar,"refresh",b(d,this,"refresh"));c(this._topToolbar,"search",b(d,this,"search"));c(this._topToolbar,"export",b(d,this,"export"));c(this._topToolbar,"print",b(d,this,"print"))}if(this._reportAlbum){c(this._reportAlbum,"resizeToolPanel",b(d,this,"resizeToolPanel"));c(this._reportAlbum,"selectView",this,"_onSelectView");c(this._reportAlbum,"removeView",this,"_onRemoveView");c(this._reportAlbum,"grpDrilldown",b(d,this,"grpDrilldown"));c(this._reportAlbum,"grpNodeRetrieveChildren",b(d,this,"grpNodeRetrieveChildren"));c(this._reportAlbum,"grpNodeCollapse",b(d,this,"grpNodeCollapse"));c(this._reportAlbum,"grpNodeExpand",b(d,this,"grpNodeExpand"));if(this._topToolbar){var a=this._reportAlbum._curView.toolPanel.initialViewType;this._topToolbar.updateToolPanelButtons(a)}}if(this._print){c(this._print,"printSubmitted",b(d,this,"printSubmitted"))}if(this._export){c(this._export,"exportSubmitted",b(d,this,"exportSubmitted"))}this._updateRefreshButton();this._loadReportPageContent();this.scrollToHighlighted();c(window,"onload",this,"removeFlashActivations");d(this,"initialized")};bobj.crv.Viewer._updateRefreshButton=function(){if(this._reportAlbum){var a=this._reportAlbum.getSelectedView();if(a){if(!a.isMainReport()){this.disableRefreshButton(true)}}}};bobj.crv.Viewer._loadReportPageContent=function(){var a=this.getReportPage();if(a){a.loadContent()}};bobj.crv.Viewer._doLayoutOnLoad=function(){this.css.visibility=this._oldCssVisibility;this._doLayout()};bobj.crv.Viewer._doLayout=function(){var i=this._topToolbar?this._topToolbar.getHeight():0;var o=this._topToolbar?this._topToolbar.getWidth():0;var n=this._botToolbar?this._botToolbar.getHeight():0;var e=this._separator?this._separator.getHeight():0;var k=this.layoutType.toLowerCase();if(bobj.crv.Viewer.LayoutTypes.CLIENT==k){this.css.width="100%";this.css.height="100%"}else{if(bobj.crv.Viewer.LayoutTypes.FITREPORT==k){var l=this._reportAlbum.getBestFitSize();var f=(l.width<o)?o:l.width;var m=(l.height+i+n+e);this.css.height=m+"px";this.css.width=f+"px"}else{this.css.width=this.visualStyle.width;this.css.height=this.visualStyle.height}}var j=this.getWidth();var a=this.getHeight();var d=Math.max(0,a-i-n-e);if(this._reportAlbum){this._reportAlbum.resizeOuter(j,d)}if(this._botToolbar){this._botToolbar.move(0,i+e+d)}if(this._print&&this._print.layer){this._print.center()}if(this._export&&this._export.layer){this._export.center()}if(this._reportProcessing&&this._reportProcessing.layer){this._reportProcessing.center()}var h=MochiKit.Style.getElementPosition(this.layer);var p=MochiKit.Style.getElementDimensions(this.layer);if(this._modalBackground){var b=this._modalBackground.style;b.top=h.y+"px";b.left=h.x+"px";b.width=p.w+"px";b.height=p.h+"px"}var c=bobj.getBodyScrollDimension();var g=((h.x+p.w)>=c.w)||((h.y+p.h)>=c.h);if(g&&(k!=bobj.crv.Viewer.LayoutTypes.CLIENT)){this.boundaryControl.updateBoundary(p.w,p.h,h.x,h.y)}else{this.boundaryControl.updateBoundary(0,0,0,0)}this._adjustWindowScrollBars()};bobj.crv.Viewer._onShowGroupTreeClick=function(b){var a=b?bobj.crv.ToolPanelType.GroupTree:bobj.crv.ToolPanelType.None;this.selectToolPanel(a)};bobj.crv.Viewer._onShowParamPanelClick=function(b){var a=b?bobj.crv.ToolPanelType.ParameterPanel:bobj.crv.ToolPanelType.None;this.selectToolPanel(a)};bobj.crv.Viewer.selectToolPanel=function(a){var b=bobj.crv.ToolPanelType;if(this._reportAlbum){this._reportAlbum._curView.toolPanel.setView(a);this._reportAlbum._curView.setDisplayToolPanel(b.None!==a)}if(b.GroupTree==a){MochiKit.Signal.signal(this,"showGroupTree")}else{if(b.ParameterPanel==a){MochiKit.Signal.signal(this,"showParamPanel")}else{if(b.None==a){MochiKit.Signal.signal(this,"hideToolPanel")}}}};bobj.crv.Viewer._onSelectView=function(a){MochiKit.Signal.signal(this,"selectView",a)};bobj.crv.Viewer._onRemoveView=function(a){MochiKit.Signal.signal(this,"removeView",a)};bobj.crv.Viewer.resize=function(a,b){if(bobj.isNumber(a)){a=a+"px"}if(bobj.isNumber(b)){b=b+"px"}this.visualStyle.width=a;this.visualStyle.height=b;this._doLayout()};bobj.crv.Viewer.disableRefreshButton=function(a){if(this._topToolbar){var b=this._topToolbar.refreshButton;if(b){b.setDisabled(a)}}if(this._botToolbar){var b=this._botToolbar.refreshButton;if(b){b.setDisabled(a)}}};bobj.crv.Viewer.setPageNumber=function(b,a){if(this._topToolbar){this._topToolbar.setPageNumber(b,a)}if(this._botToolbar){this._botToolbar.setPageNumber(b,a)}};bobj.crv.Viewer.showPromptDialog=function(a){a=a||"";if(!this._promptDlg){var b=MochiKit.Base.bind(this._onShowPromptDialog,this);var c=MochiKit.Base.bind(this._onHidePromptDialog,this);this._promptDlg=bobj.crv.params.newParameterDialog({id:this.id+"_promptDlg",showCB:b,hideCB:c})}if(this._promptDlg.isVisible()){this.hidePromptDialog()}this._originalDocumentOnKeyPress=document.onkeypress;this._promptDlg.setPromptHTML(a);setTimeout(MochiKit.Base.bind(this._promptDlg.show,this._promptDlg,true),1)};bobj.crv.Viewer.getPromptingType=function(){return this.promptingType};bobj.crv.Viewer.showFlexPromptDialog=function(h,e,f){var a=bobj.crv.params.FlexParameterUI;if(!a.checkFlashPlayer()){var d=L_bobj_crv_FlashRequired;this.showError(d.substr(0,d.indexOf("{0}")),a.getInstallHTML());return}a.setCurrentIParamInfo(this.id,h,e);a.setViewerLayoutType(this.id,this.layoutType);a.setCloseDialogCallBack(this.id,MochiKit.Base.bind(this.hideFlexPromptDialog,this));if(!this._promptDlg){this._modalBackground=document.createElement("div");this._modalBackground.id=bobj.uniqueId();var j=MochiKit.Style.getElementPosition(this.layer);var i=MochiKit.Style.getElementDimensions(this.layer);var b=this._modalBackground.style;b.top=j.y;b.left=j.x;b.width=i.w;b.height=i.h;b.backgroundColor="#888888";b.position="absolute";b.opacity=0.3;b.filter="alpha(opacity=30)";b.zIndex=bobj.constants.modalLayerIndex-2;document.body.appendChild(this._modalBackground);this._promptDlg=document.createElement("div");this._promptDlg.id=this.id+"_promptDlg";var g=this._promptDlg.style;g.border="1px";g.borderStyle="solid";g.borderColor="#000000";g.position="absolute";g.zIndex=bobj.constants.modalLayerIndex;var c=bobj.uniqueId();this._promptDlg.innerHTML='<div id="'+c+'" name="'+c+'"></div>';document.body.appendChild(this._promptDlg);a.createSWF(this.id,c,f,true)}else{this._promptDlg.style.display="";a.init(this.id)}this._modalBackground.style.visibility="visible"};bobj.crv.Viewer._onShowPromptDialog=function(){this._adjustWindowScrollBars()};bobj.crv.Viewer._onHidePromptDialog=function(){this._adjustWindowScrollBars();document.onkeypress=this._originalDocumentOnKeyPress};bobj.crv.Viewer.hidePromptDialog=function(){if(this._promptDlg&&this._promptDlg.isVisible()){this._promptDlg.show(false)}};bobj.crv.Viewer.hideFlexPromptDialog=function(){if(this._promptDlg){if(_ie){this._promptDlg.focus()}this._promptDlg.style.visibility="hidden";this._promptDlg.style.display="none";this._modalBackground.style.visibility="hidden"}};bobj.crv.Viewer._adjustWindowScrollBars=function(){if(_ie&&this.layoutType==bobj.crv.Viewer.LayoutTypes.CLIENT&&this._promptDlg&&this._promptDlg.layer&&MochiKit.DOM.currentDocument().body){var e,b;var a=MochiKit.DOM.currentDocument().body;var d=this._promptDlg.layer;if(this.getReportPage()&&this.getReportPage().layer){var c=this.getReportPage().layer}if(!window.bodyOverFlow){window.bodyOverFlow=MochiKit.DOM.getStyle(a,"overflow")}if(a.offsetHeight<(d.offsetTop+d.offsetHeight)){if(window.bodyOverFlow=="hidden"){e="scroll"}b="hidden"}else{e=window.bodyOverFlow;b="auto"}a.style.overflow=e;if(c){c.style.overflow=b}}};bobj.crv.Viewer.showError=function(c,a){var b=bobj.crv.ErrorDialog.getInstance();b.setText(c,a);b.setTitle(L_bobj_crv_Error);b.show(true)};bobj.crv.Viewer.update=function(d,a){if(!d){return}for(var b in d.children){var c=d.children[b];if(c){switch(c.cons){case"bobj.crv.newReportAlbum":if(this._reportAlbum&&a.updateReportAlbum()){this._reportAlbum.update(c,a)}break;case"bobj.crv.newToolbar":if(this._topToolbar&&a.updateToolbar()){this._topToolbar.update(c,a)}break}}}if(a.refreshLayout()){this._doLayout()}if(a.requiresScrolling()){this.scrollToHighlighted()}};bobj.crv.Viewer.getParameterPanel=function(){if(this._reportAlbum){var a=this._reportAlbum.getSelectedView();if(a&&a.toolPanel){return a.toolPanel.getParameterPanel()}}};bobj.crv.Viewer.getReportPage=function(){if(this._reportAlbum){var a=this._reportAlbum.getSelectedView();if(a&&a.toolPanel){return a.reportPage}}};bobj.crv.Viewer.scrollToHighlighted=function(){var e=this._reportAlbum.getSelectedView();var b=getLayer(e.reportPage.id);var c=getLayer("CrystalHighLighted");if(!c||!b){return}if(MochiKit.DOM.isParent(c,b)){var d=this.layoutType.toLowerCase();var a;if(d==bobj.crv.Viewer.LayoutTypes.FITREPORT){a=MochiKit.Style.getElementPosition(c);window.scrollTo(a.x,a.y)}else{a=MochiKit.Style.getElementPosition(c,b);b.scrollLeft=a.x;b.scrollTop=a.y}}};bobj.crv.Viewer.addViewerEventListener=function(c,b){var a=this._eventListeners[c];if(!a){this._eventListeners[c]=[b];return}a[a.length]=b};bobj.crv.Viewer.removeViewerEventListener=function(f,b){var a=this._eventListeners[f];if(a){for(var d=0,c=a.length;d<c;d++){if(a[d]==b){a.splice(d,1);return}}}};bobj.crv.Viewer.getEventListeners=function(a){return this._eventListeners[a]};bobj.crv.BoundaryControl=function(a){this.id=a;return this};bobj.crv.BoundaryControl.prototype={updateBoundary:function(b,a,d,c){if(!this.layer){this._init()}if(this.layer){this.layer.style.width=b;this.layer.style.height=a;this.layer.style.left=d;this.layer.style.top=c}},_init:function(){var b={display:"block",visibility:"hidden",position:"absolute"};if(!this.layer){var a=bobj.html.DIV({id:this.id,style:b});append2(_curDoc.body,a);this.layer=getLayer(this.id)}}};