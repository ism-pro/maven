bobj.crv.Tooltip={show:function(c,a,d,b){b=MochiKit.Base.update({delay:0.5,duration:0.5,aspect:2,wrapThreshold:200},b);this._options=b;this._tipHtml=c;this._x=a;this._y=d;if(!this._layer){this._createLayer();this._delayedShow=MochiKit.Base.bind(this._delayedShow,this);this._delayedHide=MochiKit.Base.bind(this._delayedHide,this)}clearTimeout(this._timeoutId);this._timeoutId=setTimeout(this._delayedShow,b.delay*1000)},_delayedShow:function(){if(this._effect){this._effect.cancel()}var a=this._layer.style;if(!this._options._fastShow){if(bobj.isString(this._tipHtml)){this._layer.firstChild.innerHTML=this._tipHtml}this._resize();bobj.placeElement(this._layer,this._x,this._y,false,false)}a.visibility="visible";this._effect=MochiKit.Visual.appear(this._layer,{duration:this._options.duration})},hide:function(a){if(this._layer){this._options=MochiKit.Base.update(this._options,a);clearTimeout(this._timeoutId);this._timeoutId=setTimeout(this._delayedHide,this._options.delay*1000)}},_delayedHide:function(){if(this._effect){this._effect.cancel()}var a=this._layer;this._effect=MochiKit.Visual.fade(a,{duration:this._options.duration,afterFinish:function(){a.style.visibility="hidden"},afterFinishInternal:null})},_elementConnections:{},setElementTooltip:function(d,e,c){var g=MochiKit.Signal.connect;if(d){if(d.bobj_crv_tooltip_id){this.removeElementTooltip(d)}else{d.bobj_crv_tooltip_id=bobj.uniqueId()}var a=[];this._elementConnections[d.bobj_crv_tooltip_id]=a;var f=function(i){var h=i.mouse().page;bobj.crv.Tooltip.show(e,h.x,h.y,c)};var b=function(h){bobj.crv.Tooltip.hide(c)};a.push(g(d,"onmouseover",f));a.push(g(d,"onmouseout",b))}},removeElementTooltip:function(c){if(c&&c.bobj_crv_tooltip_id){var b=this._elementConnections[c.bobj_crv_tooltip_id];if(b){for(var d=0,a=b.length;d<a;++d){MochiKit.Signal.disconnect(b[d])}delete this._elementConnections[c.bobj_crv_tooltip_id]}}},_createLayer:function(){var d=MochiKit.Signal.connect;var b=MochiKit.DOM.DIV;this._layer=b({"class":"crvTooltip",style:"visibility:hidden, position:absolute; display:block; top:0px; left:0px"},b(null,"&nbsp;"));MochiKit.DOM.setOpacity(this._layer,0);document.body.appendChild(this._layer);var c=function(f){if(bobj.crv.Tooltip._effect){bobj.crv.Tooltip.show(null,null,null,MochiKit.Base.update({_fastShow:true},bobj.crv.Tooltip._options))}};var a=function(f){bobj.crv.Tooltip.hide(bobj.crv.Tooltip._options)};d(this._layer,"onmouseover",c);d(this._layer,"onmouseout",a)},_resize:function(){var h=this._layer;var c=h.style;var i=h.firstChild;var a=this._options.aspect;var j=this._options.wrapThreshold;var e=c.left;c.visibility="hidden";c.left="-"+j+"px";c.width=null;c.height=null;if(i.offsetWidth>j){var f=parseInt(MochiKit.Style.computedStyle(h,"padding-top"),10)||0;f+=parseInt(MochiKit.Style.computedStyle(h,"padding-bottom"),10)||0;var g=parseInt(MochiKit.Style.computedStyle(h,"padding-left"),10)||0;g+=parseInt(MochiKit.Style.computedStyle(h,"padding-right"),10)||0;c.width="1px";c.width=(i.offsetWidth+g)+"px";i.innerHTML+="";var d=i.offsetWidth*i.offsetHeight;var k=Math.ceil(Math.sqrt(d/a));var b=k*a;c.height=k+f+"px";c.width=b+"px";while(i.offsetWidth>h.clientWidth||i.offsetHeight>h.clientHeight){k+=5;b=k*a;c.height=k+"px";c.width=b+"px"}}c.left=e||null}};