if(typeof(bobj.crv.ToolPanel)=="undefined"){bobj.crv.ToolPanel={}}if(typeof(bobj.crv.GroupTree)=="undefined"){bobj.crv.GroupTree={}}if(typeof(bobj.crv.GroupTreeNode)=="undefined"){bobj.crv.GroupTreeNode={}}bobj.crv.ToolPanelType={None:"None",GroupTree:"GroupTree",ParameterPanel:"ParameterPanel"};bobj.crv.newToolPanel=function(a){a=MochiKit.Base.update({id:bobj.uniqueId()+"_toolPanel",width:"300px",height:"100%",initialViewType:bobj.crv.ToolPanelType.None},a);var b=newWidget(a.id);bobj.fillIn(b,a);b.widgetType="ToolPanel";b._children=[];b._selectedChild=null;b.initOld=b.init;b.resizeOld=b.resize;MochiKit.Base.update(b,bobj.crv.ToolPanel);return b};bobj.crv.ToolPanel.addChild=function(e){if(!e){return}var c=MochiKit.Signal.connect;var b=MochiKit.Base.partial;var d=MochiKit.Signal.signal;var a=bobj.crv.ToolPanelType;if(e.widgetType=="GroupTree"){this._groupTree=e;c(this._groupTree,"grpDrilldown",b(d,this,"grpDrilldown"));c(this._groupTree,"grpNodeRetrieveChildren",b(d,this,"grpNodeRetrieveChildren"));c(this._groupTree,"grpNodeCollapse",b(d,this,"grpNodeCollapse"));c(this._groupTree,"grpNodeExpand",b(d,this,"grpNodeExpand"));if(this.initialViewType==a.GroupTree){this._selectedChild=e}}else{if(e.widgetType=="ParameterPanel"){this._paramPanel=e;if(this.initialViewType==a.ParameterPanel){this._selectedChild=e}}}this._children.push(e)};bobj.crv.ToolPanel.setView=function(b){if(this._selectedChild){bobj.getContainer(this._selectedChild).style.display="none"}var c=bobj.crv.ToolPanelType;if(c.GroupTree==b){this._selectedChild=this._groupTree}else{if(c.ParameterPanel==b){this._selectedChild=this._paramPanel}else{this._selectedChild=null}}var a=bobj.getContainer(this._selectedChild);if(a){a.style.display=""}this._doLayout()};bobj.crv.ToolPanel.getHTML=function(){var f=bobj.html;var k="";var c=this._children;for(var d=0,g=c.length;d<g;++d){var a=c[d];var l=a===this._selectedChild?"":"none";k+=f.DIV({style:{display:l}},a.getHTML())}var b=(bobj.crv.ToolPanelType.None!==this.initialViewType);var j={id:this.id,"class":"palette",style:{position:"absolute",margin:"0",width:this.width,height:this.height,overflow:"hidden",display:b?"":"none"}};var e=f.DIV(j,k);return e+bobj.crv.getInitHTML(this.widx)};bobj.crv.ToolPanel.init=function(){this.initOld();var c=this._children;for(var b=0,a=c.length;b<a;++b){c[b].init()}};bobj.crv.ToolPanel.update=function(d,a){if(d&&d.cons=="bobj.crv.newToolPanel"){for(var b in d.children){var c=d.children[b];if(c){switch(c.cons){case"bobj.crv.newGroupTree":if(this._groupTree&&a.updateGroupTree()){this._groupTree.update(c,a)}break;case"bobj.crv.newParameterPanel":break}}}}};bobj.crv.ToolPanel._doLayout=function(){var a=this.layer.clientWidth;var b=this.layer.clientHeight;if(this._selectedChild){this._selectedChild.setDisplay(true);this._selectedChild.resize(a,b)}};bobj.crv.ToolPanel.resize=function(a,b){bobj.setOuterSize(this.layer,a,b);this._doLayout();MochiKit.Signal.signal(this,"resize",this.layer.offsetWidth,this.layer.offsetHeight)};bobj.crv.ToolPanel.getParameterPanel=function(){return this._paramPanel};bobj.crv.newGroupTree=function(a){var c=MochiKit.Base.update;a=c({id:bobj.uniqueId(),visualStyle:{className:null,backgroundColor:null,borderWidth:null,borderStyle:null,borderColor:null,fontFamily:null,fontWeight:null,textDecoration:null,color:null,width:null,height:null,fontStyle:null,fontSize:null},icns:bobj.crvUri("images/magnify.gif"),minIcon:bobj.crvUri("images/min.gif"),plusIcon:bobj.crvUri("images/plus.gif")},a);var b=newTreeWidget(a.id+"_tree","100%","100%",a.icns,null,null,null,bobj.crv.GroupTree._expand,bobj.crv.GroupTree._collapse,null,a.minIcon,a.plusIcon);b._children=[];bobj.fillIn(b,a);b.widgetType="GroupTree";b.initOld=b.init;c(b,bobj.crv.GroupTree);return b};bobj.crv.GroupTree.addChild=function(a){var b=MochiKit.Signal.connect;a.expandPath=this._children.length+"";this._children.push(a);a._updateProperty(this.enableDrilldown,this.enableNavigation);this.add(a);a.delayedAddChild(this.enableDrilldown,this.enableNavigation);b(a,"grpDrilldown",MochiKit.Base.partial(MochiKit.Signal.signal,this,"grpDrilldown"));b(a,"grpNodeRetrieveChildren",MochiKit.Base.partial(MochiKit.Signal.signal,this,"grpNodeRetrieveChildren"))};bobj.crv.GroupTree.init=function(){this.initOld();bobj.setVisualStyle(this.layer,this.visualStyle);var c=this._children;for(var b=0,a=c.length;b<a;b++){c[b].init()}};bobj.crv.GroupTree.update=function(h,a){if(h&&a){var e=a.groupTreePath();if(e.length>0){var g=e.split("-");var c=h;var f=this;for(var d=0,b=g.length;d<b;d++){if(c&&f){c=c.children[0];f=f._children[parseInt(g[d])]}}if(c&&f&&c.args.groupPath==f.groupPath){if(f._children&&f._children.length==0){this.updateNode(c,f);f.delayedAddChild(h.args.enableDrilldown,h.args.enableNavigation)}f.expand()}}}};bobj.crv.GroupTree.updateNode=function(b,d){if(b&&d){for(var a in b.children){var c=bobj.crv.createWidget(b.children[a]);d.addChild(c)}}};bobj.crv.GroupTree._collapse=function(a){MochiKit.Signal.signal(this,"grpNodeCollapse",a)};bobj.crv.GroupTree._expand=function(a){MochiKit.Signal.signal(this,"grpNodeExpand",a)};bobj.crv.GroupTree.resize=function(b,a){bobj.setOuterSize(this.layer,b,a)};bobj.crv.newGroupTreeNode=function(b){var e=MochiKit.Base.update;b=e({id:bobj.uniqueId()},b);var a=null;var c=-1;if(!b.isVisible){c=0;a=L_bobj_crv_Tree_Drilldown_Node.replace("%1",b.groupName)}var d=newTreeWidgetElem(c,b.groupName,b.groupPath,null,null,null,a);d._children=[];bobj.fillIn(d,b);d.widgetType="GroupTreeNode";d.initOld=d.init;d.selectOld=d.select;d.select=bobj.crv.GroupTreeNode._drilldown;e(d,bobj.crv.GroupTreeNode);return d};bobj.crv.GroupTreeNode.init=function(){this.initOld();this._setVisualStyle();if(this.isStatic){var a=MochiKit.DOM.getElementsByTagAndClassName("span","treeNormal",this.layer);if(a&&a.length>0){a[0].style.cursor="text"}}};bobj.crv.GroupTreeNode.expand=function(){var a=TreeIdToIdx(this.layer);_TreeWidgetElemInstances[a].expanded=false;TreeWidget_toggleCB(a)};bobj.crv.GroupTreeNode.collapse=function(){var a=TreeIdToIdx(this.layer);_TreeWidgetElemInstances[a].expanded=true;TreeWidget_toggleCB(a)};bobj.crv.GroupTreeNode._setVisualStyle=function(){try{var e=this.layer.lastChild;var a=this.treeView}catch(c){return}var b=a.visualStyle;var d=e.style;if(b.fontFamily){d.fontFamily=b.fontFamily}if(b.fontWeight){d.fontWeight=b.fontWeight}if(b.textDecoration){d.textDecoration=b.textDecoration}if(b.color){d.color=b.color}if(b.fontStyle){d.fontStyle=b.fontStyle}if(b.fontSize){d.fontSize=b.fontSize}};bobj.crv.GroupTreeNode.delayedAddChild=function(j,h){var d=MochiKit.Signal.connect;var g=MochiKit.Signal.signal;var b=MochiKit.Base.partial;var e=this._children.length;if(e>0){this.expanded=true}else{this.expanded=false;if(!this.leaf){this.setIncomplete(bobj.crv.GroupTreeNode._getChildren)}}var c=this._children;for(var f=0;f<e;f++){var a=c[f];a.expandPath=this.expandPath+"-"+f;a._updateProperty(j,h);this.add(a);d(a,"grpDrilldown",b(g,this,"grpDrilldown"));d(a,"grpNodeRetrieveChildren",b(g,this,"grpNodeRetrieveChildren"));a.delayedAddChild(j,h)}};bobj.crv.GroupTreeNode.addChild=function(a){this._children.push(a)};bobj.crv.GroupTreeNode._drilldown=function(){this.selectOld();MochiKit.Signal.signal(this,"grpDrilldown",this.groupName,this.groupPath,this.isVisible)};bobj.crv.GroupTreeNode._getChildren=function(){this.plusLyr.src=_skin+"../loading.gif";MochiKit.Signal.signal(this,"grpNodeRetrieveChildren",this.expandPath)};bobj.crv.GroupTreeNode._updateProperty=function(b,c){var a=false;if(this.isVisible&&!c){a=true}else{if(!this.isVisible&&!b){a=true}}if(a){this.select=function(){}}this.isStatic=a};