if(typeof bobj.crv.params=="undefined"){bobj.crv.params={};bobj.crv.params.DataTypes={DATE:"d",DATE_TIME:"dt",TIME:"t",STRING:"s",NUMBER:"n",CURRENCY:"c",BOOLEAN:"b"};bobj.crv.params.RangeBoundTypes={UNBOUNDED:0,EXCLUSIVE:1,INCLUSIVE:2};bobj.crv.params.DefaultDisplayTypes={Description:0,DescriptionAndValue:1};bobj.crv.params.CompareResults={TOO_BIG:1,TOO_SMALL:-1,EQUAL:0}}bobj.crv.params.Parameter=function(b){var c=bobj.crv.params;var a=c.DefaultDisplayTypes;MochiKit.Base.update(this,{paramName:null,reportName:null,description:null,valueDataType:null,value:null,modifiedValue:null,defaultValues:null,defaultDisplayType:a.DescriptionAndValue,maxValue:null,minValue:null,allowCustomValue:true,allowDiscreteValue:true,allowMultiValue:false,allowNullValue:false,allowRangeValue:false,editMask:null,isOptionalPrompt:false,isEditable:true,isHidden:false,isDataFetching:false,attributes:null},b);this.valueCounter=new c.ValueCounter(this.value,this.valueDataType)};bobj.crv.params.Parameter.prototype={getTitle:function(){return(this.description||this.paramName)},hasLOV:function(){return(this.defaultValues&&this.defaultValues.length)},isPassword:function(){return(this.editMask!==null&&this.editMask.toLowerCase()=="password")},getValue:function(){this._initModifiedValue();return this.modifiedValue},removeValueAt:function(a){this._initModifiedValue();var b=this.modifiedValue[a];this.modifiedValue.splice(a,1);this.valueCounter.reduceCount(b)},setValue:function(b,d){this._initModifiedValue();if(arguments.length==1&&bobj.isArray(arguments[0])){var c=arguments[0];this.modifiedValue=c;this.valueCounter.resetValue(c)}else{if(arguments.length==2){var a=this.modifiedValue[b];this.modifiedValue[b]=d;this.valueCounter.reduceCount(a);this.valueCounter.addCount(d)}}},clearValue:function(){this._initModifiedValue();this.modifiedValue=[]},commitValue:function(){this._initModifiedValue();this.value=this.modifiedValue.slice(0)},_initModifiedValue:function(){if(!this.modifiedValue){if(bobj.isArray(this.value)){this.modifiedValue=this.value.slice(0)}else{this.modifiedValue=[]}}},addDuplicateValuesCB:function(b,a){this.valueCounter.addCallBacks(b,a)},isDCP:function(){if(this.attributes!=null){if(this.attributes.IsDCP===true){return true}}return false}};bobj.crv.params.Validator=function(){};bobj.crv.params.Validator.ValueStatus={OK:0,ERROR:1,VALUE_MISSING:2,VALUE_INVALID_TYPE:3,VALUE_TOO_LONG:4,VALUE_TOO_SHORT:5,VALUE_TOO_BIG:6,VALUE_TOO_SMALL:7,VALUE_DUPLICATE:8};bobj.crv.params.Validator.getInstance=function(){if(!bobj.crv.params.Validator.__instance){bobj.crv.params.Validator.__instance=new bobj.crv.params.Validator()}return bobj.crv.params.Validator.__instance};bobj.crv.params.Validator.prototype={validateParameter:function(h){var g=bobj.crv.params;if(!h){return null}var b=g.Validator.ValueStatus;if(!bobj.isArray(h.value)||!h.value.length){return{isValid:false,reason:b.VALUE_MISSING}}var f=true;var e=[];for(var d=0,a=h.values.length;d<a;++d){var c=g.validateValue(h,d);e.push(c);f=f&&(c===ValueStatus.OK)}return{isValid:f,statusList:e}},validateValue:function(d,b){var a=bobj.crv.params.Validator.ValueStatus;if(!d||!bobj.isArray(d.value)||(b===undefined)){return a.ERROR}var c=this._getTypeValidatorFunc(d.valueDataType);if(!c){return a.ERROR}return c(d,b)},_getTypeValidatorFunc:function(b){var a=bobj.crv.params.DataTypes;switch(b){case a.STRING:return this._validateString;case a.NUMBER:case a.CURRENCY:return this._validateNumber;case a.DATE:case a.TIME:case a.DATE_TIME:return this._validateDateTime;case a.BOOLEAN:return this._validateBoolean;default:return null}},_validateString:function(e,c){var a=bobj.crv.params.Validator.ValueStatus;if(!bobj.isString(c)){return a.VALUE_INVALID_TYPE}var d=e.maxValue;var b=e.minValue;if(bobj.isNumber(d)&&c.length>d){return a.VALUE_TOO_LONG}if(bobj.isNumber(b)&&c.length<b){return a.VALUE_TOO_SHORT}return a.OK},_validateNumber:function(f,d){var a=bobj.crv.params.Validator.ValueStatus;var b=/^(\+|-)?(\d+(\.\d+)?|\.\d+)$/;if(bobj.isString(d)&&b.test(d)){d=parseFloat(d)}else{if(!bobj.isNumber(d)){return a.VALUE_INVALID_TYPE}}var e=f.maxValue;var c=f.minValue;if(e!==null&&d>e){return a.VALUE_TOO_BIG}else{if(c!==null&&d<c){return a.VALUE_TOO_SMALL}else{return a.OK}}},_validateDateTime:function(e,d){var f=bobj.crv.params.CompareResults;var a=bobj.crv.params.Validator.ValueStatus;if(bobj.isObject(d)){var b=function(g){return bobj.isNumber(d[g])};if(MochiKit.Iter.every(["d","m","y","h","min","s","ms"],b)){var c=bobj.crv.params.getDateCompareFunc(e.valueDataType);if(e.minValue&&c(e.minValue,d)==f.TOO_BIG){return a.VALUE_TOO_SMALL}else{if(e.maxValue&&c(e.maxValue,d)==f.TOO_SMALL){return a.VALUE_TOO_BIG}else{return a.OK}}}}return a.VALUE_INVALID_TYPE},_validateBoolean:function(b,a){return bobj.crv.params.Validator.ValueStatus.OK}};bobj.crv.params.dateToJson=function(a){return{d:a.getDate(),m:a.getMonth(),y:a.getFullYear(),h:a.getHours(),min:a.getMinutes(),s:a.getSeconds(),ms:a.getMilliseconds()}};bobj.crv.params.getDateCompareFunc=function(b){var c=bobj.crv.params;var a=c.DataTypes;switch(b){case a.DATE:return c.compareDate;case a.TIME:return c.compareTime;case a.DATE_TIME:return c.compareDateTime;default:return null}};bobj.crv.params.compareDateTime=function(b,a){var e=bobj.crv.params;var f=e.CompareResults;var d=e.compareDate(b,a);var c=e.compareTime(b,a);if(d==f.EQUAL&&c==f.EQUAL){return f.EQUAL}if(d!=f.EQUAL){return d}else{return c}};bobj.crv.params.compareDate=function(b,a){var c=bobj.crv.params.CompareResults;if(b.d==a.d&&b.m==a.m&&b.y==a.y){return c.EQUAL}if(b.y>a.y){return c.TOO_BIG}else{if(b.y<a.y){return c.TOO_SMALL}}if(b.m>a.m){return c.TOO_BIG}else{if(b.m<a.m){return c.TOO_SMALL}}if(b.d>a.d){return c.TOO_BIG}else{if(b.d<a.d){return c.TOO_SMALL}}};bobj.crv.params.compareTime=function(b,a){var c=bobj.crv.params.CompareResults;if(b.h==a.h&&b.min==a.min&&b.s==a.s&&b.ms==a.ms){return c.EQUAL}if(b.h>a.h){return c.TOO_BIG}else{if(b.h<a.h){return c.TOO_SMALL}}if(b.min>a.min){return c.TOO_BIG}else{if(b.min<a.min){return c.TOO_SMALL}}if(b.s>a.s){return c.TOO_BIG}else{if(b.s<a.s){return c.TOO_SMALL}}if(b.ms>a.ms){return c.TOO_BIG}else{if(b.ms<a.ms){return c.TOO_SMALL}}};bobj.crv.params.jsonToDate=function(b){var a=new Date();if(b){a.setFullYear(b.y||0,b.m||0,b.d||1);a.setHours(b.h||0);a.setMinutes(b.min||0);a.setSeconds(b.s||0);a.setMilliseconds(b.ms||0)}return a};bobj.crv.params.ValueCounter=function(a,b){this.values={};this.valueDataType=b;this.valueHasDupCB=null;this.valueNoDupCB=null;this.resetValue(a)};bobj.crv.params.ValueCounter.prototype={addCallBacks:function(a,b){this.valueHasDupCB=a;this.valueNoDupCB=b},addCount:function(a){if(a!==null&&a!==undefined&&a.beginValue===undefined){var b=bobj.getValueHashCode(this.valueDataType,a);if(this.values[b]!==null&&this.values[b]!==undefined){this.values[b]+=1;if(this.valueHasDupCB&&this.values[b]>1){this.valueHasDupCB(a)}}else{this.values[b]=1}}},reduceCount:function(a){if(a!==null&&a!==undefined&&a.beginValue===undefined){var b=bobj.getValueHashCode(this.valueDataType,a);this.values[b]-=1;if(this.valueNoDupCB&&this.values[b]==1){this.valueNoDupCB(a)}}},resetValue:function(d){if(this.valueNoDupCB){this.valueNoDupCB()}for(var b in this.values){if(this.values[b]>0){this.values[b]=0}}if(bobj.isArray(d)){for(var c=0,a=d.length;c<a;c++){this.addCount(d[c])}}else{this.addCount(d)}}};