
PrimeFaces.widget.ColumnToggler=PrimeFaces.widget.DeferredWidget.extend({init:function(b){this._super(b);this.table=PrimeFaces.expressions.SearchExpressionFacade.resolveComponentsAsSelector(this.cfg.datasource);this.trigger=PrimeFaces.expressions.SearchExpressionFacade.resolveComponentsAsSelector(this.cfg.trigger);this.tableId=this.table.attr("id");this.thead=$(PrimeFaces.escapeClientId(this.tableId)+"_head");this.tbody=$(PrimeFaces.escapeClientId(this.tableId)+"_data");this.tfoot=$(PrimeFaces.escapeClientId(this.tableId)+"_foot");this.visible=false;this.render();this.bindEvents()},render:function(){this.columns=this.thead.find("> tr > th:not(.ui-static-column)");this.panel=$("<div></div>").attr("id",this.cfg.id).attr("role","dialog").addClass("ui-columntoggler ui-widget ui-widget-content ui-shadow ui-corner-all").append('<ul class="ui-columntoggler-items" role="group"></ul').appendTo(document.body);this.itemContainer=this.panel.children("ul");for(var r=0;r<this.columns.length;r++){var u=this.columns.eq(r),q=u.hasClass("ui-helper-hidden"),p=q?"ui-chkbox-box ui-widget ui-corner-all ui-state-default":"ui-chkbox-box ui-widget ui-corner-all ui-state-default ui-state-active",o=(q)?"ui-chkbox-icon ui-icon ui-icon-blank":"ui-chkbox-icon ui-icon ui-icon-check",n=u.children(".ui-column-title").text();this.hasPriorityColumns=u.is('[class*="ui-column-p-"]');var i=$('<li class="ui-columntoggler-item"><div class="ui-chkbox ui-widget"><div class="ui-helper-hidden-accessible"><input type="checkbox" role="checkbox"></div><div class="'+p+'"><span class="'+o+'"></span></div></div><label>'+n+"</label></li>").data("column",u.attr("id"));if(this.hasPriorityColumns){var v=u.attr("class").split(" ");for(var s=0;s<v.length;s++){var t=v[s],j=t.indexOf("ui-column-p-");if(j!==-1){i.addClass(t.substring(j,j+13))}}}if(!q){i.find("> .ui-chkbox > .ui-helper-hidden-accessible > input").prop("checked",true).attr("aria-checked",true)}i.appendTo(this.itemContainer)}this.closer=$('<a href="#" class="ui-columntoggler-close"><span class="ui-icon ui-icon-close"></span></a>').attr("aria-label","Close").prependTo(this.panel);if(this.panel.outerHeight()>200){this.panel.height(200)}this.hide()},bindEvents:function(){var f=this,d="mousedown."+this.id,e="resize."+this.id;this.trigger.off("click.ui-columntoggler").on("click.ui-columntoggler",function(a){if(f.visible){f.hide()}else{f.show()}});this.itemContainer.find("> .ui-columntoggler-item > .ui-chkbox > .ui-chkbox-box").on("mouseover.columnToggler",function(){var a=$(this);if(!a.hasClass("ui-state-active")){a.addClass("ui-state-hover")}}).on("mouseout.columnToggler",function(){$(this).removeClass("ui-state-hover")}).on("click.columnToggler",function(a){f.toggle($(this));a.preventDefault()});this.itemContainer.find("> .ui-columntoggler-item > label").on("click.selectCheckboxMenu",function(a){f.toggle($(this).prev().children(".ui-chkbox-box"));PrimeFaces.clearSelection();a.preventDefault()});this.closer.on("click",function(a){f.trigger.focus();f.hide();a.preventDefault()});this.bindKeyEvents();$(document.body).off(d).on(d,function(b){if(!f.visible){return}var c=$(b.target);if(f.trigger.is(c)||f.trigger.has(c).length){return}var a=f.panel.offset();if(b.pageX<a.left||b.pageX>a.left+f.panel.width()||b.pageY<a.top||b.pageY>a.top+f.panel.height()){f.hide()}});$(window).off(e).on(e,function(){if(f.visible){f.alignPanel()}})},bindKeyEvents:function(){var c=this,d=this.itemContainer.find("> li > div.ui-chkbox > div.ui-helper-hidden-accessible > input");this.trigger.on("focus.columnToggler",function(){$(this).addClass("ui-state-focus")}).on("blur.columnToggler",function(){$(this).removeClass("ui-state-focus")}).on("keydown.columnToggler",function(a){var b=$.ui.keyCode,e=a.which;switch(e){case b.ENTER:case b.NUMPAD_ENTER:if(c.visible){c.hide()}else{c.show()}a.preventDefault();break;case b.TAB:if(c.visible){c.itemContainer.children("li:not(.ui-state-disabled):first").find("div.ui-helper-hidden-accessible > input").trigger("focus");a.preventDefault()}break}});d.on("focus.columnToggler",function(){var b=$(this),a=b.parent().next();if(b.prop("checked")){a.removeClass("ui-state-active")}a.addClass("ui-state-focus")}).on("blur.columnToggler",function(a){var e=$(this),b=e.parent().next();if(e.prop("checked")){b.addClass("ui-state-active")}b.removeClass("ui-state-focus")}).on("keydown.columnToggler",function(a){if(a.which===$.ui.keyCode.TAB){var b=$(this).closest("li").index();if(a.shiftKey){if(b===0){c.closer.focus()}else{d.eq(b-1).focus()}}else{if(b===(c.columns.length-1)&&!a.shiftKey){c.closer.focus()}else{d.eq(b+1).focus()}}a.preventDefault()}}).on("change.columnToggler",function(a){var e=$(this),b=e.parent().next();if(e.prop("checked")){c.check(b);b.removeClass("ui-state-active")}else{c.uncheck(b)}});this.closer.on("keydown.columnToggler",function(a){var e=a.which,b=$.ui.keyCode;if((e===b.ENTER||e===b.NUMPAD_ENTER)){c.hide();c.trigger.focus();a.preventDefault()}else{if(e===b.TAB){if(a.shiftKey){d.eq(c.columns.length-1).focus()}else{d.eq(0).focus()}a.preventDefault()}}})},toggle:function(b){if(b.hasClass("ui-state-active")){this.uncheck(b)}else{this.check(b)}},check:function(h){h.addClass("ui-state-active").removeClass("ui-state-hover").children(".ui-chkbox-icon").addClass("ui-icon-check").removeClass("ui-icon-blank");var e=$(document.getElementById(h.closest("li.ui-columntoggler-item").data("column"))).index()+1,g=this.thead.children("tr").find("th:nth-child("+e+")"),f=h.prev().children("input");f.prop("checked",true).attr("aria-checked",true);g.removeClass("ui-helper-hidden");$(PrimeFaces.escapeClientId(g.attr("id")+"_clone")).removeClass("ui-helper-hidden");this.tbody.children("tr").find("td:nth-child("+e+")").removeClass("ui-helper-hidden");this.tfoot.children("tr").find("td:nth-child("+e+")").removeClass("ui-helper-hidden");this.fireToggleEvent(true,(e-1));this.updateColspan()},uncheck:function(h){h.removeClass("ui-state-active").children(".ui-chkbox-icon").addClass("ui-icon-blank").removeClass("ui-icon-check");var e=$(document.getElementById(h.closest("li.ui-columntoggler-item").data("column"))).index()+1,g=this.thead.children("tr").find("th:nth-child("+e+")"),f=h.prev().children("input");f.prop("checked",false).attr("aria-checked",false);g.addClass("ui-helper-hidden");$(PrimeFaces.escapeClientId(g.attr("id")+"_clone")).addClass("ui-helper-hidden");this.tbody.children("tr").find("td:nth-child("+e+")").addClass("ui-helper-hidden");this.tfoot.children("tr").find("td:nth-child("+e+")").addClass("ui-helper-hidden");this.fireToggleEvent(false,(e-1));this.updateColspan()},alignPanel:function(){this.panel.css({left:"",top:"","z-index":++PrimeFaces.zindex}).position({my:"left top",at:"left bottom",of:this.trigger});if(this.hasPriorityColumns){if(this.panel.outerWidth()<=this.trigger.outerWidth()){this.panel.css("width","auto")}this.widthAligned=false}if(!this.widthAligned&&(this.panel.outerWidth()<this.trigger.outerWidth())){this.panel.width(this.trigger.width());this.widthAligned=true}},show:function(){this.alignPanel();this.panel.show();this.visible=true;this.trigger.attr("aria-expanded",true);this.closer.trigger("focus")},hide:function(){this.panel.fadeOut("fast");this.visible=false;this.trigger.attr("aria-expanded",false)},fireToggleEvent:function(h,j){if(this.cfg.behaviors){var f=this.cfg.behaviors.toggle;if(f){var g=h?"VISIBLE":"HIDDEN",i={params:[{name:this.id+"_visibility",value:g},{name:this.id+"_index",value:j}]};f.call(this,i)}}},updateColspan:function(){var d=this.tbody.children("tr:first");if(d&&d.hasClass("ui-datatable-empty-message")){var c=this.itemContainer.find("> .ui-columntoggler-item > .ui-chkbox > .ui-chkbox-box.ui-state-active");if(c.length){d.children("td").removeClass("ui-helper-hidden").attr("colspan",c.length)}else{d.children("td").addClass("ui-helper-hidden")}}}});